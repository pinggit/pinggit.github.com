<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="copyright" content="Aug 2014, ping ubuntu 14.04 laptop *** Ping Song *** Powered by AsciiDoc and W3C Slidy &amp;#169;" />
<meta name="generator" content="AsciiDoc 8.6.9 / slidy2 backend 1.0.3" />
<meta name="description" content="the case involves both multicast vpn and bgp issue" />
<meta name="keywords" content="bgp mvpn multicast routing RESO JUNOS" />
<meta name="duration" content="7" />
<meta name="font-size-adjustment" content="-2" />
<title>PR995293 case study</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<style type="text/css">
/* slidy.css

   Copyright (c) 2005-2010 W3C (MIT, ERCIM, Keio), All Rights Reserved.
   W3C liability, trademark, document use and software licensing
   rules apply, see:

   http://www.w3.org/Consortium/Legal/copyright-documents
   http://www.w3.org/Consortium/Legal/copyright-software
*/

/*
   SJR: 2010-09-29: Modified for AsciiDoc slidy backend.
   Mostly just commented out stuff that is handled by AsciiDoc's CSS files.
*/

body
{
  margin: 0 0 0 0;
  padding: 0 0 0 0;
  width: 100%;
  height: 100%;
  color: black;
  background-color: white;
/*
  font-family: "Gill Sans MT", "Gill Sans", GillSans, sans-serif;
*/
  font-size: 14pt;
}

div.toolbar {
  position: fixed; z-index: 200;
  top: auto; bottom: 0; left: 0; right: 0;
  height: 1.2em; text-align: right;
  padding-left: 1em;
  padding-right: 1em;
  font-size: 60%;
  color: red;
  background-color: rgb(240,240,240);
  border-top: solid 1px rgb(180,180,180);
}

div.toolbar span.copyright {
  color: black;
  margin-left: 0.5em;
}

div.initial_prompt {
  position: absolute;
  z-index: 1000;
  bottom: 1.2em;
  width: 90%;
  background-color: rgb(200,200,200);
  opacity: 0.35;
  cursor: pointer;
}

div.initial_prompt p.help {
  text-align: center;
}

div.initial_prompt p.close {
  text-align: right;
  font-style: italic;
}

div.slidy_toc {
  position: absolute;
  z-index: 300;
  width: 60%;
  max-width: 30em;
  height: 30em;
  overflow: auto;
  top: auto;
  right: auto;
  left: 4em;
  bottom: 4em;
  padding: 1em;
  background: rgb(240,240,240);
  border-style: solid;
  border-width: 2px;
  font-size: 60%;
}

div.slidy_toc .toc_heading {
  text-align: center;
  width: 100%;
  margin: 0;
  margin-bottom: 1em;
  border-bottom-style: solid;
  border-bottom-color: rgb(180,180,180);
  border-bottom-width: 1px;
}

div.slide {
  z-index: 20;
  margin: 0 0 0 0;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 20px;
  padding-right: 20px;
  border-width: 0;
  clear: both;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  line-height: 120%;
  background-color: transparent;
}

div.background {
  display: none;
}

div.handout {
  margin-left: 20px;
  margin-right: 20px;
}

div.slide.titlepage {
  text-align: center;
}

div.slide.titlepage.h1 {
  padding-top: 10%;
}

div.slide h1 {
  padding-left: 0;
  padding-right: 20pt;
  padding-top: 4pt;
  padding-bottom: 4pt;
  margin-top: 0;
  margin-left: 0;
  margin-right: 60pt;
  margin-bottom: 0.5em;
  display: block;
  font-size: 160%;
  line-height: 1.2em;
  background: transparent;
}

div.toc {
  position: absolute;
  top: auto;
  bottom: 4em;
  left: 4em;
  right: auto;
  width: 60%;
  max-width: 30em;
  height: 30em;
  border: solid thin black;
  padding: 1em;
  background: rgb(240,240,240);
  color: black;
  z-index: 300;
  overflow: auto;
  display: block;
  visibility: visible;
}

div.toc-heading {
  width: 100%;
  border-bottom: solid 1px rgb(180,180,180);
  margin-bottom: 1em;
  text-align: center;
}

/*
pre {
 font-size: 80%;
 font-weight: bold;
 line-height: 120%;
 padding-top: 0.2em;
 padding-bottom: 0.2em;
 padding-left: 1em;
 padding-right: 1em;
 border-style: solid;
 border-left-width: 1em;
 border-top-width: thin;
 border-right-width: thin;
 border-bottom-width: thin;
 border-color: #95ABD0;
 color: #00428C;
 background-color: #E4E5E7;
}
*/

/*
li pre { margin-left: 0; }

blockquote { font-style: italic }

img { background-color: transparent }

p.copyright { font-size: smaller }
*/

.center { text-align: center }
.footnote { font-size: smaller; margin-left: 2em; }

/*
a img { border-width: 0; border-style: none }
*/

a:visited { color: navy }
a:link { color: navy }
a:hover { color: red; text-decoration: underline }
a:active { color: red; text-decoration: underline }

a {text-decoration: none}
.navbar a:link {color: white}
.navbar a:visited {color: yellow}
.navbar a:active {color: red}
.navbar a:hover {color: red}

/*
ul { list-style-type: square; }
ul ul { list-style-type: disc; }
ul ul ul { list-style-type: circle; }
ul ul ul ul { list-style-type: disc; }
li { margin-left: 0.5em; margin-top: 0.5em; }
li li { font-size: 85%; font-style: italic }
li li li { font-size: 85%; font-style: normal }
*/

div dt
{
  margin-left: 0;
  margin-top: 1em;
  margin-bottom: 0.5em;
  font-weight: bold;
}
div dd
{
  margin-left: 2em;
  margin-bottom: 0.5em;
}


/*
p,pre,ul,ol,blockquote,h2,h3,h4,h5,h6,dl,table {
  margin-left: 1em;
  margin-right: 1em;
}
*/

p.subhead { font-weight: bold; margin-top: 2em; }

.smaller { font-size: smaller }
.bigger { font-size: 130% }

/*
td,th { padding: 0.2em }
*/

ul {
  margin: 0.5em 1.5em 0.5em 1.5em;
  padding: 0;
}

ol {
  margin: 0.5em 1.5em 0.5em 1.5em;
  padding: 0;
}

ul { list-style-type: square; }
ul ul { list-style-type: disc; }
ul ul ul { list-style-type: circle; }
ul ul ul ul { list-style-type: disc; }

/*
ul li {
  list-style: square;
  margin: 0.1em 0em 0.6em 0;
  padding: 0 0 0 0;
  line-height: 140%;
}

ol li {
  margin: 0.1em 0em 0.6em 1.5em;
  padding: 0 0 0 0px;
  line-height: 140%;
  list-style-type: decimal;
}

li ul li {
  font-size: 85%;
  font-style: italic;
  list-style-type: disc;
  background: transparent;
  padding: 0 0 0 0;
}
li li ul li {
  font-size: 85%;
  font-style: normal;
  list-style-type: circle;
  background: transparent;
  padding: 0 0 0 0;
}
li li li ul li {
  list-style-type: disc;
  background: transparent;
  padding: 0 0 0 0;
}

li ol li {
  list-style-type: decimal;
}


li li ol li {
  list-style-type: decimal;
}
*/

/*
 setting class="outline" on ol or ul makes it behave as an
 ouline list where blocklevel content in li elements is
 hidden by default and can be expanded or collapsed with
 mouse click. Set class="expand" on li to override default
*/

ol.outline li:hover { cursor: pointer }
ol.outline li.nofold:hover { cursor: default }

ul.outline li:hover { cursor: pointer }
ul.outline li.nofold:hover { cursor: default }

ol.outline { list-style:decimal; }
ol.outline ol { list-style-type:lower-alpha }

ol.outline li.nofold {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/nofold-dim.gif) no-repeat 0px 0.5em;
}
ol.outline li.unfolded {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/fold-dim.gif) no-repeat 0px 0.5em;
}
ol.outline li.folded {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/unfold-dim.gif) no-repeat 0px 0.5em;
}
ol.outline li.unfolded:hover {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/fold.gif) no-repeat 0px 0.5em;
}
ol.outline li.folded:hover {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/unfold.gif) no-repeat 0px 0.5em;
}

ul.outline li.nofold {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/nofold-dim.gif) no-repeat 0px 0.5em;
}
ul.outline li.unfolded {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/fold-dim.gif) no-repeat 0px 0.5em;
}
ul.outline li.folded {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/unfold-dim.gif) no-repeat 0px 0.5em;
}
ul.outline li.unfolded:hover {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/fold.gif) no-repeat 0px 0.5em;
}
ul.outline li.folded:hover {
  padding: 0 0 0 20px;
  background: transparent url(../graphics/unfold.gif) no-repeat 0px 0.5em;
}

/* for slides with class "title" in table of contents */
a.titleslide { font-weight: bold; font-style: italic }

/*
 hide images for work around for save as bug
 where browsers fail to save images used by CSS
*/
img.hidden { display: none; visibility: hidden }
div.initial_prompt { display: none; visibility: hidden }

  div.slide {
     visibility: visible;
     position: inherit;
  }
  div.handout {
     border-top-style: solid;
     border-top-width: thin;
     border-top-color: black;
  }

@media screen {
  .hidden { display: none; visibility: visible }

  div.slide.hidden { display: block; visibility: visible }
  div.handout.hidden { display: block; visibility: visible }
  div.background { display: none; visibility: hidden }
  body.single_slide div.initial_prompt { display: block; visibility: visible }
  body.single_slide div.background { display: block; visibility: visible }
  body.single_slide div.background.hidden { display: none; visibility: hidden }
  body.single_slide .invisible { visibility: hidden }
  body.single_slide .hidden { display: none; visibility: hidden }
  body.single_slide div.slide { position: absolute }
  body.single_slide div.handout { display: none; visibility: hidden }
}

@media print {
  .hidden { display: block; visibility: visible }

/*
  div.slide pre { font-size: 60%; padding-left: 0.5em; }
*/
  div.toolbar { display: none; visibility: hidden; }
  div.slidy_toc { display: none; visibility: hidden; }
  div.background { display: none; visibility: hidden; }
  div.slide { page-break-before: always }
  /* :first-child isn't reliable for print media */
  div.slide.first-slide { page-break-before: avoid }
}


/* SJR: AsciiDoc slidy backend tweaks */

ol, ul {
  margin: 0.8em 1.5em 0.8em 1.8em;
}
li > ul, li > ol {
  margin-top: 0.5em;
}

.outline > li.folded,
.outline > li.unfolded {
  color: #527bbd;
}
ul > li{ color: #aaa; }
ul > li > *, ol > li > * { color: black; }

li {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

/* jmi hack */
@media screen {
  body.single_slide .invisible { opacity: 0.15; visibility: visible; }
  /*img.invisible { opacity: 0.1; visibility: visible; } */
  img.invisible { visibility: hidden !important }
}
a {text-decoration: underline;}
</style>
<style type="text/css" title="slidy_color_set_none">
/* empty color set styles */
</style>
<style type="text/css" title="slidy_color_set_yellow">
/* rainbow color styles */
body { background-color: #ffffaa;}
a:link, a:visited, a:hover, a:active { color: blue; text-decoration: underline }
a:hover { color: red; text-decoration: underline }
div.slide { color: black;}
div.slide h1,h2,h3,h4,h5,h6 { color: orange;}
em { color: green;}
tt { color: green;}
div.sidebarblock, div.literalblock, div.listingblock, div.exampleblock, div.title { color: red;}
div.quoteblock, div.verseblock {  color: black; }
div.admonitionblock { color: red;}
</style>
<style type="text/css" title="slidy_color_set_green">
/* blue color styles */
body { background-color: #449900;}
a:link, a:visited, a:hover, a:active { color: fuchsia; text-decoration: underline }
a:hover { color: red; text-decoration: underline }
div.slide { color: yellow;}
div.slide h1,h2,h3,h4,h5,h6 { color: lime;}
em { color: orange;}
tt { color: orange;}
div.sidebarblock, div.literalblock, div.listingblock, div.exampleblock, div.title { color: #44ff00;}
div.quoteblock, div.verseblock {  color: black; }
div.admonitionblock { color: #88ff55;}
</style>
<style type="text/css" title="slidy_color_set_blue">
/* blue color styles */
body { background-color: navy;}
a:link, a:visited, a:hover, a:active { color: yellow; text-decoration: underline }
a:hover { color: red; text-decoration: underline }
div.slide { background-color: navy; color: aqua;}
div.slide h1,h2,h3,h4,h5,h6 { color: aqua;}
em { color: blue;}
tt { color: blue;}
div.sidebarblock, div.literalblock, div.listingblock, div.exampleblock, div.title { color: teal;}
div.admonitionblock { color: teal;}
</style>
<style type="text/css" title="slidy_color_set_black">
/* black color set styles */
body { background-color: black !important; }
a:link, a:visited, a:hover, a:active { color: gray; text-decoration: underline }
a:hover { color: red; text-decoration: underline }
div.slide { color: silver !important; }
span, caption, th { color: silver !important; }
div.slide h1,h2,h3,h4,h5,h6 { color: white;}
em, strong { color: #999999;}
tt { color: blue;}
div.sidebarblock, div.literalblock, div.listingblock, div.exampleblock, div.title { color: black; }
div.admonitionblock, div.quoteblock, div.verseblock {  color: white; }
div.cover.slide, div.cover.slide h1 { background-color: black; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
/* slidy.js

   Copyright (c) 2005-2010 W3C (MIT, ERCIM, Keio), All Rights Reserved.
   W3C liability, trademark, document use and software licensing
   rules apply, see:

   http://www.w3.org/Consortium/Legal/copyright-documents
   http://www.w3.org/Consortium/Legal/copyright-software

   Defines single name "w3c_slidy" in global namespace
   Adds event handlers without trampling on any others

   JMI: Dynamic features added
*/

// the slidy object implementation
var w3c_slidy = {
  // classify which kind of browser we're running under
  ns_pos: (typeof window.pageYOffset!='undefined'),
  khtml: ((navigator.userAgent).indexOf("KHTML") >= 0 ? true : false),
  opera: ((navigator.userAgent).indexOf("Opera") >= 0 ? true : false),
  ipad: ((navigator.userAgent).indexOf("iPad") >= 0 ? true : false),
  iphone: ((navigator.userAgent).indexOf("iPhone") >= 0 ? true : false),
  ie: (typeof document.all != "undefined" && !this.opera),
  ie6: (!this.ns_pos && navigator.userAgent.indexOf("MSIE 6") != -1),
  ie7: (!this.ns_pos && navigator.userAgent.indexOf("MSIE 7") != -1),
  ie8: (!this.ns_pos && navigator.userAgent.indexOf("MSIE 8") != -1),
  ie9: (!this.ns_pos && navigator.userAgent.indexOf("MSIE 9") != -1),
  keyboardless: (this.ipad || this.iphone),

  // are we running as XHTML? (doesn't work on Opera)
  is_xhtml: /xml/.test(document.contentType),

  slide_number: 0, // integer slide count: 0, 1, 2, ...
  slide_number_element: null, // element containing slide number
  slides: [], // set to array of slide div's
  notes: [], // set to array of handout div's
  backgrounds: [], // set to array of background div's
  toolbar: null, // element containing toolbar
  title: null, // document title
  last_shown: null, // last incrementally shown item
  eos: null,  // span element for end of slide indicator
  toc: null, // table of contents
  outline: null, // outline element with the focus
  selected_text_len: 0, // length of drag selection on document
  view_all: 0,  // 1 to view all slides + handouts
  want_toolbar: true,  // user preference to show/hide toolbar
  mouse_click_enabled: true, // enables left click for next slide
  scroll_hack: 0, // IE work around for position: fixed
  disable_slide_click: false,  // used by clicked anchors

  lang: "en", // updated to language specified by html file

  help_anchor: null, // used for keyboard focus hack in showToolbar()
  help_page: "http://www.w3.org/Talks/Tools/Slidy2/help/help.html",
  help_text: "Navigate with mouse click, space bar, Cursor Left/Right, " +
             "or Pg Up and Pg Dn. Use S and B to change font size.",
// jmi
  help_keymap:
    "PGDN\t: nextSlide\n" +
     "PGUP\t: previousSlide\n" +
     "HOME\t: firstSlide\n" +
     "END  \t: lastSlide\n" +
     "SPACE\t: nextContent\n" +
     "->  \t: nextContent\n" +
     "<-  \t: previousContent\n" +
     "A   \t: toggleAllSlides\n" +
     "F   \t: toggleFooter\n" +
     "K   \t: toggleMouseClick\n" +
     "I   \t: toggleIncremental\n" +
     "L   \t: toggleColorSet\n" +
     "T, C\t: tableOfContents\n" +
     "B   \t: biggerFontSize\n" +
     "S   \t: smallerFontSize\n" +
     "M   \t: key mapping\n",

  size_index: 0,
  size_adjustment: 0,
  sizes:  new Array("10pt", "12pt", "14pt", "16pt", "18pt", "20pt",
                    "22pt", "24pt", "26pt", "28pt", "30pt", "32pt"),

  // needed for efficient resizing
  last_width: 0,
  last_height: 0,


  // Needed for cross browser support for relative width/height on
  // object elements. The work around is to save width/height attributes
  // and then to recompute absolute width/height dimensions on resizing
   objects: [],

//jmi
incremental_display: true,

  // attach initialiation event handlers
  set_up: function () {
    var init = function() { w3c_slidy.init(); };
    if (typeof window.addEventListener != "undefined")
      window.addEventListener("load", init, false);
    else
      window.attachEvent("onload", init);
  },

  hide_slides: function () {
    if (document.body && !w3c_slidy.initialized)
      document.body.style.visibility = "hidden";
    else
      setTimeout(w3c_slidy.hide_slides, 50);
  },

  // hack to persuade IE to compute correct document height
  // as needed for simulating fixed positioning of toolbar
  ie_hack: function () {
    window.resizeBy(0,-1);
    window.resizeBy(0, 1);
  },

  init: function () {
    //alert("slidy starting test 10");
    document.body.style.visibility = "visible";
    this.init_localization();
    this.add_toolbar();
    this.wrap_implicit_slides();
    this.collect_slides();
    this.collect_notes();
    this.collect_backgrounds();
    this.objects = document.body.getElementsByTagName("object");
    this.patch_anchors();
    this.slide_number = this.find_slide_number(location.href);
    window.offscreenbuffering = true;
    this.size_adjustment = this.find_size_adjust();
    this.time_left = this.find_duration();
    this.hide_image_toolbar();  // suppress IE image toolbar popup
    this.init_outliner();  // activate fold/unfold support
    this.title = document.title;
    // jmi
    this.color_sets = new Array();
    this.init_color_sets();

    // work around for opera bug
    this.is_xhtml = (document.body.tagName == "BODY" ? false : true);

    if (this.slides.length > 0)
    {
      var slide = this.slides[this.slide_number];

      if (this.slide_number > 0)
      {
        this.set_visibility_all_incremental("visible");
        this.last_shown = this.previous_incremental_item(null);
        this.set_eos_status(true);
      }
      else
      {
        this.last_shown = null;
        this.set_visibility_all_incremental("hidden");
        this.set_eos_status(!this.next_incremental_item(this.last_shown));
      }

      this.set_location();
      this.add_class(this.slides[0], "first-slide");
      w3c_slidy.show_slide(slide);
    }

    this.toc = this.table_of_contents();

    this.add_initial_prompt();

    // bind event handlers without interfering with custom page scripts
    // Tap events behave too weirdly to support clicks reliably on
    // iPhone and iPad, so exclude these from click handler

    if (!this.keyboardless)
      this.add_listener(document.body, "click", this.mouse_button_click);

    this.add_listener(document, "keydown", this.key_down);
    this.add_listener(document, "keypress", this.key_press);
    this.add_listener(window, "resize", this.resized);
    this.add_listener(window, "scroll", this.scrolled);
    this.add_listener(window, "unload", this.unloaded);

    // this seems to be a debugging hack
    //if (!document.body.onclick)
    //  document.body.onclick = function () { };

    this.single_slide_view();

    //this.set_location();

    this.resized();

    if (this.ie7)
      setTimeout(w3c_slidy.ie_hack, 100);

    this.show_toolbar();

    // for back button detection
    setInterval(function () { w3c_slidy.check_location(); }, 200);
    w3c_slidy.initialized = true;
  },

  // create div element with links to each slide
  table_of_contents: function () {
    var toc = this.create_element("div");
    this.add_class(toc, "slidy_toc hidden");
    //toc.setAttribute("tabindex", "0");

    var heading = this.create_element("div");
    this.add_class(heading, "toc-heading");
    heading.innerHTML = this.localize("Table of Contents");

    toc.appendChild(heading);
    var previous = null;

    for (var i = 0; i < this.slides.length; ++i)
    {
      var title = this.has_class(this.slides[i], "title");
      var num = document.createTextNode((i + 1) + ". ");

      toc.appendChild(num);

      var a = this.create_element("a");
      a.setAttribute("href", "#(" + (i+1) + ")");

      if (title)
        this.add_class(a, "titleslide");

      var name = document.createTextNode(this.slide_name(i));
      a.appendChild(name);
      a.onclick = w3c_slidy.toc_click;
      a.onkeydown = w3c_slidy.toc_key_down;
      a.previous = previous;

      if (previous)
        previous.next = a;

      toc.appendChild(a);

      if (i == 0)
        toc.first = a;

      if (i < this.slides.length - 1)
      {
        var br = this.create_element("br");
        toc.appendChild(br);
      }

      previous = a;
    }

    toc.focus = function () {
      if (this.first)
        this.first.focus();
    }

    toc.onmouseup = w3c_slidy.mouse_button_up;

    toc.onclick = function (e) {
      e||(e=window.event);

      if (w3c_slidy.selected_text_len <= 0)
         w3c_slidy.hide_table_of_contents(true);

      w3c_slidy.stop_propagation(e);

      if (e.cancel != undefined)
        e.cancel = true;

      if (e.returnValue != undefined)
        e.returnValue = false;

      return false;
    };

    document.body.insertBefore(toc, document.body.firstChild);
    return toc;
  },

  is_shown_toc: function () {
    return !w3c_slidy.has_class(w3c_slidy.toc, "hidden");
  },

  show_table_of_contents: function () {
    w3c_slidy.remove_class(w3c_slidy.toc, "hidden");
    var toc = w3c_slidy.toc;
    toc.focus();

    if (w3c_slidy.ie7 && w3c_slidy.slide_number == 0)
      setTimeout(w3c_slidy.ie_hack, 100);
  },

  hide_table_of_contents: function (focus) {
    w3c_slidy.add_class(w3c_slidy.toc, "hidden");

    if (focus && !w3c_slidy.opera)
      w3c_slidy.help_anchor.focus();
  },

  toggle_table_of_contents: function () {
    if (w3c_slidy.is_shown_toc())
      w3c_slidy.hide_table_of_contents(true);
    else
      w3c_slidy.show_table_of_contents();
  },

  // called on clicking toc entry
  toc_click: function (e) {
    if (!e)
      e = window.event;

    var target = w3c_slidy.get_target(e);

    if (target && target.nodeType == 1)
    {
      var uri = target.getAttribute("href");

      if (uri)
      {
        //alert("going to " + uri);
        var slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.hide_slide(slide);
        w3c_slidy.slide_number = w3c_slidy.find_slide_number(uri);
        slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.last_shown = null;
        w3c_slidy.set_location();
        w3c_slidy.set_visibility_all_incremental("hidden");
        w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));
        w3c_slidy.show_slide(slide);
        //target.focus();

        try
        {
          if (!w3c_slidy.opera)
            w3c_slidy.help_anchor.focus();
        }
        catch (e)
        {
        }
      }
    }

    w3c_slidy.hide_table_of_contents(true);
    if (w3c_slidy.ie7) w3c_slidy.ie_hack();
    w3c_slidy.stop_propagation(e);
    return w3c_slidy.cancel(e);
  },

  // called onkeydown for toc entry
  toc_key_down: function (event) {
    var key;

    if (!event)
      var event = window.event;

    // kludge around NS/IE differences
    if (window.event)
      key = window.event.keyCode;
    else if (event.which)
      key = event.which;
    else
      return true; // Yikes! unknown browser

    // ignore event if key value is zero
    // as for alt on Opera and Konqueror
    if (!key)
      return true;

    // check for concurrent control/command/alt key
    // but are these only present on mouse events?

    if (event.ctrlKey || event.altKey)
      return true;

    if (key == 13)
    {
      var uri = this.getAttribute("href");

      if (uri)
      {
        //alert("going to " + uri);
       var slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.hide_slide(slide);
        w3c_slidy.slide_number = w3c_slidy.find_slide_number(uri);
        slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.last_shown = null;
        w3c_slidy.set_location();
        w3c_slidy.set_visibility_all_incremental("hidden");
        w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));
        w3c_slidy.show_slide(slide);
        //target.focus();

        try
        {
          if (!w3c_slidy.opera)
            w3c_slidy.help_anchor.focus();
        }
        catch (e)
        {
        }
      }

      w3c_slidy.hide_table_of_contents(true);

      if (self.ie7)
       w3c_slidy.ie_hack();

      return w3c_slidy.cancel(event);
    }

    if (key == 40 && this.next)
    {
      this.next.focus();
      return w3c_slidy.cancel(event);
    }

    if (key == 38 && this.previous)
    {
      this.previous.focus();
      return w3c_slidy.cancel(event);
    }

    return true;
  },


  // ### OBSOLETE ###
  before_print: function () {
    this.show_all_slides();
    this.hide_toolbar();
    alert("before print");
  },

  // ### OBSOLETE ###
  after_print: function () {
    if (!this.view_all)
    {
      this.single_slide_view();
      this.show_toolbar();
    }
    alert("after print");
  },

  // ### OBSOLETE ###
  print_slides: function () {
    this.before_print();
    window.print();
    this.after_print();
  },

  // ### OBSOLETE ?? ###
  toggle_view: function () {
    if (this.view_all)
    {
      this.single_slide_view();
      this.show_toolbar();
      this.view_all = 0;
    }
    else
    {
      this.show_all_slides();
      this.hide_toolbar();
      this.view_all = 1;
    }
  },

  // prepare for printing  ### OBSOLETE ###
  show_all_slides: function () {
    this.remove_class(document.body, "single_slide");
    this.set_visibility_all_incremental("visible");
  },

  // restore after printing  ### OBSOLETE ###
  single_slide_view: function () {
    this.add_class(document.body, "single_slide");
    this.set_visibility_all_incremental("visible");
    this.last_shown = this.previous_incremental_item(null);
  },

  // suppress IE's image toolbar pop up
  hide_image_toolbar: function () {
    if (!this.ns_pos)
    {
      var images = document.getElementsByTagName("IMG");

      for (var i = 0; i < images.length; ++i)
        images[i].setAttribute("galleryimg", "no");
    }
  },

  unloaded: function (e) {
    //alert("unloaded");
  },

  // Safari and Konqueror don't yet support getComputedStyle()
  // and they always reload page when location.href is updated
  is_KHTML: function () {
    var agent = navigator.userAgent;
    return (agent.indexOf("KHTML") >= 0 ? true : false);
  },

  // find slide name from first h1 element
  // default to document title + slide number
  slide_name: function (index) {
    var name = null;
    var slide = this.slides[index];

    var heading = this.find_heading(slide);

    if (heading)
      name = this.extract_text(heading);

    if (!name)
      name = this.title + "(" + (index + 1) + ")";

    name.replace(/\&/g, "&amp;");
    name.replace(/\</g, "&lt;");
    name.replace(/\>/g, "&gt;");

    return name;
  },

  // find first h1 element in DOM tree
  find_heading: function (node) {
    if (!node || node.nodeType != 1)
      return null;

    if (node.nodeName == "H1" || node.nodeName == "h1")
      return node;

    var child = node.firstChild;

    while (child)
    {
      node = this.find_heading(child);

      if (node)
        return node;

      child = child.nextSibling;
    }

    return null;
  },

  // recursively extract text from DOM tree
  extract_text: function (node) {
    if (!node)
      return "";

    // text nodes
    if (node.nodeType == 3)
      return node.nodeValue;

    // elements
    if (node.nodeType == 1)
    {
      node = node.firstChild;
      var text = "";

      while (node)
      {
        text = text + this.extract_text(node);
        node = node.nextSibling;
      }

      return text;
    }

    return "";
  },

  // find copyright text from meta element
  find_copyright: function () {
    var name, content;
    var meta = document.getElementsByTagName("meta");

    for (var i = 0; i < meta.length; ++i)
    {
      name = meta[i].getAttribute("name");
      content = meta[i].getAttribute("content");

      if (name == "copyright")
        return content;
    }

    return null;
  },

  find_size_adjust: function () {
    var name, content, offset;
    var meta = document.getElementsByTagName("meta");

    for (var i = 0; i < meta.length; ++i)
    {
      name = meta[i].getAttribute("name");
      content = meta[i].getAttribute("content");

      if (name == "font-size-adjustment")
        return 1 * content;
    }

    return 1;
  },

  // <meta name="duration" content="20" />  for 20 minutes
  find_duration: function () {
    var name, content, offset;
    var meta = document.getElementsByTagName("meta");

    for (var i = 0; i < meta.length; ++i)
    {
      name = meta[i].getAttribute("name");
      content = meta[i].getAttribute("content");

      if (name == "duration")
        return 60000 * content;
    }

    return null;
  },

  replace_by_non_breaking_space: function (str) {
    for (var i = 0; i < str.length; ++i)
      str[i] = 160;
  },

  // ### CHECK ME ### is use of "li" okay for text/html?
  // for XHTML do we also need to specify namespace?
  init_outliner: function () {
    var items = document.getElementsByTagName("li");

    for (var i = 0; i < items.length; ++i)
    {
      var target = items[i];

      if (!this.has_class(target.parentNode, "outline"))
        continue;

      target.onclick = this.outline_click;
/* ### more work needed for IE6
      if (!this.ns_pos)
      {
        target.onmouseover = this.hover_outline;
        target.onmouseout = this.unhover_outline;
      }
*/
      if (this.foldable(target))
      {
        target.foldable = true;
        target.onfocus = function () {w3c_slidy.outline = this;};
        target.onblur = function () {w3c_slidy.outline = null;};

        if (!target.getAttribute("tabindex"))
          target.setAttribute("tabindex", "0");

        if (this.has_class(target, "expand"))
          this.unfold(target);
        else
          this.fold(target);
      }
      else
      {
        this.add_class(target, "nofold");
        target.visible = true;
        target.foldable = false;
      }
    }
  },

  foldable: function (item) {
    if (!item || item.nodeType != 1)
      return false;

    var node = item.firstChild;

    while (node)
    {
      if (node.nodeType == 1 && this.is_block(node))
        return true;

      node = node.nextSibling;
    }

    return false;
  },

  // ### CHECK ME ### switch to add/remove "hidden" class
  fold: function (item) {
    if (item)
    {
      this.remove_class(item, "unfolded");
      this.add_class(item, "folded");
    }

    var node = item ? item.firstChild : null;

    while (node)
    {
      if (node.nodeType == 1 && this.is_block(node)) // element
      {
         w3c_slidy.add_class(node, "hidden");
      }

      node = node.nextSibling;
    }

    item.visible = false;
  },

  // ### CHECK ME ### switch to add/remove "hidden" class
  unfold: function (item) {
    if (item)
    {
      this.add_class(item, "unfolded");
      this.remove_class(item, "folded");
    }

    var node = item ? item.firstChild : null;

    while (node)
    {
      if (node.nodeType == 1 && this.is_block(node)) // element
      {
        w3c_slidy.remove_class(node, "hidden");
      }

      node = node.nextSibling;
    }

    item.visible = true;
  },

  outline_click: function (e) {
    if (!e)
      e = window.event;

    var rightclick = false;
    var target = w3c_slidy.get_target(e);

    while (target && target.visible == undefined)
      target = target.parentNode;

    if (!target)
      return true;

    if (e.which)
      rightclick = (e.which == 3);
    else if (e.button)
      rightclick = (e.button == 2);

    if (!rightclick && target.visible != undefined)
    {
      if (target.foldable)
      {
        if (target.visible)
          w3c_slidy.fold(target);
        else
          w3c_slidy.unfold(target);
      }

      w3c_slidy.stop_propagation(e);
      e.cancel = true;
      e.returnValue = false;
    }

    return false;
  },

  add_initial_prompt: function () {
    var prompt = this.create_element("div");
    prompt.setAttribute("class", "initial_prompt");

    var p1 = this.create_element("p");
    prompt.appendChild(p1);
    p1.setAttribute("class", "help");

    if (this.keyboardless)
      p1.innerHTML = "Tap footer to move to next slide";
    else
      p1.innerHTML = "Space or Right Arrow to move to next " +
                     "slide, M to see keys mapping, click help below for more details";

    this.add_listener(prompt, "click", function (e) {
      document.body.removeChild(prompt);
      w3c_slidy.stop_propagation(e);

      if (e.cancel != undefined)
        e.cancel = true;

      if (e.returnValue != undefined)
        e.returnValue = false;

      return false;
    });

    document.body.appendChild(prompt);
    this.initial_prompt = prompt;
    setTimeout(function() {document.body.removeChild(prompt);}, 5000);
  },

  add_toolbar: function () {
    var counter, page;

     this.toolbar = this.create_element("div");
     this.toolbar.setAttribute("class", "toolbar");

     // a reasonably behaved browser
     if (this.ns_pos || !this.ie6)
     {
       var right = this.create_element("div");
       right.setAttribute("style", "float: right; text-align: right");

       counter = this.create_element("span")
       counter.innerHTML = this.localize("slide") + " n/m";
       right.appendChild(counter);
       this.toolbar.appendChild(right);

       var left = this.create_element("div");
       left.setAttribute("style", "text-align: left");

       // global end of slide indicator
       this.eos = this.create_element("span");
       this.eos.innerHTML = "* ";
       left.appendChild(this.eos);

       var help = this.create_element("a");
       help.setAttribute("href", this.help_page);
       help.setAttribute("title", this.localize(this.help_text));
       help.innerHTML = this.localize("help?");
       left.appendChild(help);
       this.help_anchor = help;  // save for focus hack

       var gap1 = document.createTextNode(" ");
       left.appendChild(gap1);

       var contents = this.create_element("a");
       contents.setAttribute("href", "javascript:w3c_slidy.toggle_table_of_contents()");
       contents.setAttribute("title", this.localize("table of contents"));
       contents.innerHTML = this.localize("contents?");
       left.appendChild(contents);

       var gap2 = document.createTextNode(" ");
       left.appendChild(gap2);

       var copyright = this.find_copyright();

       if (copyright)
       {
         var span = this.create_element("span");
         span.className = "copyright";
         span.innerHTML = copyright;
         left.appendChild(span);
       }

       this.toolbar.setAttribute("tabindex", "0");
       this.toolbar.appendChild(left);
     }
     else // IE6 so need to work around its poor CSS support
     {
       this.toolbar.style.position = (this.ie7 ? "fixed" : "absolute");
       this.toolbar.style.zIndex = "200";
       this.toolbar.style.width = "99.9%";
       this.toolbar.style.height = "1.2em";
       this.toolbar.style.top = "auto";
       this.toolbar.style.bottom = "0";
       this.toolbar.style.left = "0";
       this.toolbar.style.right = "0";
       this.toolbar.style.textAlign = "left";
       this.toolbar.style.fontSize = "60%";
       this.toolbar.style.color = "red";
       this.toolbar.borderWidth = 0;
       this.toolbar.className = "toolbar";
       this.toolbar.style.background = "rgb(240,240,240)";

       // would like to have help text left aligned
       // and page counter right aligned, floating
       // div's don't work, so instead use nested
       // absolutely positioned div's.

       var sp = this.create_element("span");
       sp.innerHTML = "&nbsp;&nbsp;*&nbsp;";
       this.toolbar.appendChild(sp);
       this.eos = sp;  // end of slide indicator

       var help = this.create_element("a");
       help.setAttribute("href", this.help_page);
       help.setAttribute("title", this.localize(this.help_text));
       help.innerHTML = this.localize("help?");
       this.toolbar.appendChild(help);
       this.help_anchor = help;  // save for focus hack

       var gap1 = document.createTextNode(" ");
       this.toolbar.appendChild(gap1);

       var contents = this.create_element("a");
       contents.setAttribute("href", "javascript:toggleTableOfContents()");
       contents.setAttribute("title", this.localize("table of contents".localize));
       contents.innerHTML = this.localize("contents?");
       this.toolbar.appendChild(contents);

       var gap2 = document.createTextNode(" ");
       this.toolbar.appendChild(gap2);

       var copyright = this.find_copyright();

       if (copyright)
       {
         var span = this.create_element("span");
         span.innerHTML = copyright;
         span.style.color = "black";
         span.style.marginLeft = "0.5em";
         this.toolbar.appendChild(span);
       }

       counter = this.create_element("div")
       counter.style.position = "absolute";
       counter.style.width = "auto"; //"20%";
       counter.style.height = "1.2em";
       counter.style.top = "auto";
       counter.style.bottom = 0;
       counter.style.right = "0";
       counter.style.textAlign = "right";
       counter.style.color = "red";
       counter.style.background = "rgb(240,240,240)";

       counter.innerHTML = this.localize("slide") + " n/m";
       this.toolbar.appendChild(counter);
     }

     // ensure that click isn't passed through to the page
     this.toolbar.onclick =
         function (e) {
           if (!e)
             e = window.event;

           var target = e.target;

           if (!target && e.srcElement)
             target = e.srcElement;

           // work around Safari bug
           if (target && target.nodeType == 3)
             target = target.parentNode;

           w3c_slidy.stop_propagation(e);

           if (target && target.nodeName.toLowerCase() != "a")
             w3c_slidy.mouse_button_click(e);
         };

     this.slide_number_element = counter;
     this.set_eos_status(false);
     document.body.appendChild(this.toolbar);
  },

  // wysiwyg editors make it hard to use div elements
  // e.g. amaya loses the div when you copy and paste
  // this function wraps div elements around implicit
  // slides which start with an h1 element and continue
  // up to the next heading or div element
  wrap_implicit_slides: function () {
    var i, heading, node, next, div;
    var headings = document.getElementsByTagName("h1");

    if (!headings)
      return;

    for (i = 0; i < headings.length; ++i)
    {
      heading = headings[i];

      if (heading.parentNode != document.body)
        continue;

      node = heading.nextSibling;

      div = document.createElement("div");
      this.add_class(div, "slide");
      document.body.replaceChild(div, heading);
      div.appendChild(heading);

      while (node)
      {
        if (node.nodeType == 1 &&    // an element
             (node.nodeName == "H1" ||
              node.nodeName == "h1" ||
              node.nodeName == "DIV" ||
              node.nodeName == "div"))
          break;

        next = node.nextSibling;
        node = document.body.removeChild(node);
        div.appendChild(node);
        node = next;
      }
    }
  },

// return new array of all slides
  collect_slides: function () {
    var slides = new Array();
    var divs = document.body.getElementsByTagName("div");

    for (var i = 0; i < divs.length; ++i)
    {
      div = divs.item(i);

      if (this.has_class(div, "slide"))
      {
        // add slide to collection
        slides[slides.length] = div;

        // hide each slide as it is found
        this.add_class(div, "hidden");

        // add dummy <br/> at end for scrolling hack
        var node1 = document.createElement("br");
        div.appendChild(node1);
        var node2 = document.createElement("br");
        div.appendChild(node2);
      }
      else if (this.has_class(div, "background"))
      {  // work around for Firefox SVG reload bug
        // which otherwise replaces 1st SVG graphic with 2nd
        div.style.display = "block";
      }
    }

    this.slides = slides;
  },

  // return new array of all <div class="handout">
  collect_notes: function () {
    var notes = new Array();
    var divs = document.body.getElementsByTagName("div");

    for (var i = 0; i < divs.length; ++i)
    {
      div = divs.item(i);

      if (this.has_class(div, "handout"))
      {
        // add note to collection
        notes[notes.length] = div;

        // and hide it
        this.add_class(div, "hidden");
      }
    }

    this.notes = notes;
  },

  // return new array of all <div class="background">
  // including named backgrounds e.g. class="background titlepage"
  collect_backgrounds: function () {
    var backgrounds = new Array();
    var divs = document.body.getElementsByTagName("div");

    for (var i = 0; i < divs.length; ++i)
    {
      div = divs.item(i);

      if (this.has_class(div, "background"))
      {
        // add background to collection
        backgrounds[backgrounds.length] = div;

        // and hide it
        this.add_class(div, "hidden");
      }
    }

    this.backgrounds = backgrounds;
  },

  // set click handlers on all anchors
  patch_anchors: function () {
    var self = w3c_slidy;
    var handler = function (event) {
      // compare this.href with location.href
      // for link to another slide in this doc

      if (self.page_address(this.href) == self.page_address(location.href))
      {
        // yes, so find new slide number
        var newslidenum = self.find_slide_number(this.href);

        if (newslidenum != self.slide_number)
        {
          var slide = self.slides[self.slide_number];
          self.hide_slide(slide);
          self.slide_number = newslidenum;
          slide = self.slides[self.slide_number];
          self.show_slide(slide);
          self.set_location();
        }
      }
      else
        w3c_slidy.stop_propagation(event);

//      else if (this.target == null)
//        location.href = this.href;

      this.blur();
      self.disable_slide_click = true;
    };

    var anchors = document.body.getElementsByTagName("a");

    for (var i = 0; i < anchors.length; ++i)
    {
      if (window.addEventListener)
        anchors[i].addEventListener("click", handler, false);
      else
        anchors[i].attachEvent("onclick", handler);
    }
  },

  // ### CHECK ME ### see which functions are invoked via setTimeout
  // either directly or indirectly for use of w3c_slidy vs this
  show_slide_number: function () {
    var timer = w3c_slidy.get_timer();
    w3c_slidy.slide_number_element.innerHTML = timer + w3c_slidy.localize("slide") + " " +
           (w3c_slidy.slide_number + 1) + "/" + w3c_slidy.slides.length;
  },

  // every 200mS check if the location has been changed as a
  // result of the user activating the Back button/menu item
  // doesn't work for Opera < 9.5
  check_location: function () {
    var hash = location.hash;

    if (w3c_slidy.slide_number > 0 && (hash == "" || hash == "#"))
      w3c_slidy.goto_slide(0);
    else if (hash.length > 2 && hash != "#("+(w3c_slidy.slide_number+1)+")")
    {
      var num = parseInt(location.hash.substr(2));

      if (!isNaN(num))
        w3c_slidy.goto_slide(num-1);
    }

    if (w3c_slidy.time_left && w3c_slidy.slide_number > 0)
    {
      w3c_slidy.show_slide_number();

      if (w3c_slidy.time_left > 0)
        w3c_slidy.time_left -= 200;
    }
  },

  get_timer: function () {
    var timer = "";
    if (w3c_slidy.time_left)
    {
      var mins, secs;
      secs = Math.floor(w3c_slidy.time_left/1000);
      mins = Math.floor(secs / 60);
      secs = secs % 60;
      timer = (mins ? mins+"m" : "") + secs + "s ";
    }

    return timer;
  },

  // this doesn't push location onto history stack for IE
  // for which a hidden iframe hack is needed: load page into
  // the iframe with script that set's parent's location.hash
  // but that won't work for standalone use unless we can
  // create the page dynamically via a javascript: URL
  set_location: function () {
     var uri = w3c_slidy.page_address(location.href);
     var hash = "#(" + (w3c_slidy.slide_number+1) + ")";

     if (w3c_slidy.slide_number >= 0)
       uri = uri + hash;

     if (w3c_slidy.ie && !w3c_slidy.ie8)
       w3c_slidy.push_hash(hash);

     if (uri != location.href) // && !khtml
        location.href = uri;

     if (this.khtml)
        hash = "(" + (w3c_slidy.slide_number+1) + ")";

     if (!this.ie && location.hash != hash && location.hash != "")
       location.hash = hash;

     document.title = w3c_slidy.title + " (" + (w3c_slidy.slide_number+1) + ")";
     w3c_slidy.show_slide_number();
  },

  page_address: function (uri) {
    var i = uri.indexOf("#");

    if (i < 0)
      i = uri.indexOf("%23");

    // check if anchor is entire page

    if (i < 0)
      return uri;  // yes

    return uri.substr(0, i);
  },

  // only used for IE6 and IE7
  on_frame_loaded: function (hash) {
    location.hash = hash;
    var uri = w3c_slidy.page_address(location.href);
    location.href = uri + hash;
  },

  // history hack with thanks to Bertrand Le Roy
  push_hash: function (hash) {
    if (hash == "") hash = "#(1)";
      window.location.hash = hash;

    var doc = document.getElementById("historyFrame").contentWindow.document;
  },

  // find current slide based upon location
  // first find target anchor and then look
  // for associated div element enclosing it
  // finally map that to slide number
  find_slide_number: function (uri) {
    // first get anchor from page location

    var i = uri.indexOf("#");

    // check if anchor is entire page
    if (i < 0)
      return 0;  // yes

    var anchor = unescape(uri.substr(i+1));

    // now use anchor as XML ID to find target
    var target = document.getElementById(anchor);

    if (!target)
    {
      // does anchor look like "(2)" for slide 2 ??
      // where first slide is (1)
      var re = /\((\d)+\)/;

      if (anchor.match(re))
      {
        var num = parseInt(anchor.substring(1, anchor.length-1));

        if (num > this.slides.length)
          num = 1;

        if (--num < 0)
          num = 0;

        return num;
      }

      // accept [2] for backwards compatibility
      re = /\[(\d)+\]/;

      if (anchor.match(re))
      {
         var num = parseInt(anchor.substring(1, anchor.length-1));

         if (num > this.slides.length)
            num = 1;

         if (--num < 0)
            num = 0;

         return num;
      }

      // oh dear unknown anchor
      return 0;
    }

    // search for enclosing slide

    while (true)
    {
      // browser coerces html elements to uppercase!
      if (target.nodeName.toLowerCase() == "div" &&
            this.has_class(target, "slide"))
      {
        // found the slide element
        break;
      }

      // otherwise try parent element if any

      target = target.parentNode;

      if (!target)
      {
        return 0;   // no luck!
      }
    };

    for (i = 0; i < slides.length; ++i)
    {
      if (slides[i] == target)
        return i;  // success
    }

    // oh dear still no luck
    return 0;
  },

  previous_slide: function (incremental) {
    if (!w3c_slidy.view_all)
    {
      var slide;

//jmi
if (!w3c_slidy.incremental_display) {incremental = false;}

      if ((incremental || w3c_slidy.slide_number == 0) && w3c_slidy.last_shown != null)
      {
        w3c_slidy.last_shown = w3c_slidy.hide_previous_item(w3c_slidy.last_shown);
        w3c_slidy.set_eos_status(false);
      }
      else if (w3c_slidy.slide_number > 0)
      {
        slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.hide_slide(slide);

        w3c_slidy.slide_number = w3c_slidy.slide_number - 1;
        slide = w3c_slidy.slides[w3c_slidy.slide_number];
        w3c_slidy.set_visibility_all_incremental("visible");
        w3c_slidy.last_shown = w3c_slidy.previous_incremental_item(null);
        w3c_slidy.set_eos_status(true);
        w3c_slidy.show_slide(slide);
      }

      w3c_slidy.set_location();

      if (!w3c_slidy.ns_pos)
        w3c_slidy.refresh_toolbar(200);
    }
  },

  next_slide: function (incremental) {
    if (!w3c_slidy.view_all)
    {
      var slide, last = w3c_slidy.last_shown;
//jmi
if (!w3c_slidy.incremental_display) {incremental = false;}

      if (incremental || w3c_slidy.slide_number == w3c_slidy.slides.length - 1)
         w3c_slidy.last_shown = w3c_slidy.reveal_next_item(w3c_slidy.last_shown);

      if ((!incremental || w3c_slidy.last_shown == null) &&
             w3c_slidy.slide_number < w3c_slidy.slides.length - 1)
      {
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.hide_slide(slide);

         w3c_slidy.slide_number = w3c_slidy.slide_number + 1;
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.last_shown = null;
         w3c_slidy.set_visibility_all_incremental("hidden");
         w3c_slidy.show_slide(slide);
      }
      else if (!w3c_slidy.last_shown)
      {
         if (last && incremental)
           w3c_slidy.last_shown = last;
      }

      w3c_slidy.set_location();

      w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));

      if (!w3c_slidy.ns_pos)
         w3c_slidy.refresh_toolbar(200);
     }
  },

  // to first slide with nothing revealed
  // i.e. state at start of presentation
  first_slide: function () {
     if (!w3c_slidy.view_all)
     {
       var slide;

       if (w3c_slidy.slide_number != 0)
       {
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.hide_slide(slide);

         w3c_slidy.slide_number = 0;
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.last_shown = null;
         w3c_slidy.set_visibility_all_incremental("hidden");
         w3c_slidy.show_slide(slide);
       }

       w3c_slidy.set_eos_status(
         !w3c_slidy.next_incremental_item(w3c_slidy.last_shown));
       w3c_slidy.set_location();
     }
  },

  // goto last slide with everything revealed
  // i.e. state at end of presentation
  last_slide: function () {
    if (!w3c_slidy.view_all)
    {
      var slide;

      w3c_slidy.last_shown = null; //revealNextItem(lastShown);

      if (w3c_slidy.last_shown == null &&
          w3c_slidy.slide_number < w3c_slidy.slides.length - 1)
      {
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.hide_slide(slide);
         w3c_slidy.slide_number = w3c_slidy.slides.length - 1;
         slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.set_visibility_all_incremental("visible");
         w3c_slidy.last_shown = w3c_slidy.previous_incremental_item(null);

         w3c_slidy.show_slide(slide);
      }
      else
      {
         w3c_slidy.set_visibility_all_incremental("visible");
         w3c_slidy.last_shown = w3c_slidy.previous_incremental_item(null);
      }

      w3c_slidy.set_eos_status(true);
      w3c_slidy.set_location();
    }
  },


  // ### check this and consider add/remove class
  set_eos_status: function (state) {
    if (this.eos)
      this.eos.style.color = (state ? "rgb(240,240,240)" : "red");
  },

  // first slide is 0
  goto_slide: function (num) {
    //alert("going to slide " + (num+1));
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];
    w3c_slidy.hide_slide(slide);
    w3c_slidy.slide_number = num;
    slide = w3c_slidy.slides[w3c_slidy.slide_number];
    w3c_slidy.last_shown = null;
    w3c_slidy.set_visibility_all_incremental("hidden");
    w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));
    document.title = w3c_slidy.title + " (" + (w3c_slidy.slide_number+1) + ")";
    w3c_slidy.show_slide(slide);
    w3c_slidy.show_slide_number();
  },


  show_slide: function (slide) {
    this.sync_background(slide);
    window.scrollTo(0,0);
    this.remove_class(slide, "hidden");
  },

  hide_slide: function (slide) {
    this.add_class(slide, "hidden");
  },

  // show just the backgrounds pertinent to this slide
  // when slide background-color is transparent
  // this should now work with rgba color values
  sync_background: function (slide) {
    var background;
    var bgColor;

    if (slide.currentStyle)
      bgColor = slide.currentStyle["backgroundColor"];
    else if (document.defaultView)
    {
      var styles = document.defaultView.getComputedStyle(slide,null);

      if (styles)
        bgColor = styles.getPropertyValue("background-color");
      else // broken implementation probably due Safari or Konqueror
      {
        //alert("defective implementation of getComputedStyle()");
        bgColor = "transparent";
      }
    }
    else
      bgColor == "transparent";

    if (bgColor == "transparent" ||
        bgColor.indexOf("rgba") >= 0 ||
        bgColor.indexOf("opacity") >= 0)
    {
      var slideClass = this.get_class_list(slide);

      for (var i = 0; i < this.backgrounds.length; i++)
      {
        background = this.backgrounds[i];

        var bgClass = this.get_class_list(background);

        if (this.matching_background(slideClass, bgClass))
          this.remove_class(background, "hidden");
        else
          this.add_class(background, "hidden");
      }
    }
    else // forcibly hide all backgrounds
      this.hide_backgrounds();
  },

  hide_backgrounds: function () {
    for (var i = 0; i < this.backgrounds.length; i++)
    {
      background = this.backgrounds[i];
      this.add_class(background, "hidden");
    }
  },

  // compare classes for slide and background
  matching_background: function (slideClass, bgClass) {
    var i, count, pattern, result;

    // define pattern as regular expression
    pattern = /\w+/g;

    // check background class names
    result = bgClass.match(pattern);

    for (i = count = 0; i < result.length; i++)
    {
      if (result[i] == "hidden")
        continue;

      if (result[i] == "background")
	continue;

      ++count;
    }

    if (count == 0)  // default match
      return true;

    // check for matches and place result in array
    result = slideClass.match(pattern);

    // now check if desired name is present for background
    for (i = count = 0; i < result.length; i++)
    {
      if (result[i] == "hidden")
        continue;

      if (this.has_token(bgClass, result[i]))
        return true;
    }

    return false;
  },

  resized: function () {
     var width = 0;

     if ( typeof( window.innerWidth ) == 'number' )
       width = window.innerWidth;  // Non IE browser
     else if (document.documentElement && document.documentElement.clientWidth)
       width = document.documentElement.clientWidth;  // IE6
     else if (document.body && document.body.clientWidth)
       width = document.body.clientWidth; // IE4

     var height = 0;

     if ( typeof( window.innerHeight ) == 'number' )
       height = window.innerHeight;  // Non IE browser
     else if (document.documentElement && document.documentElement.clientHeight)
       height = document.documentElement.clientHeight;  // IE6
     else if (document.body && document.body.clientHeight)
       height = document.body.clientHeight; // IE4

     if (height && (width/height > 1.05*1024/768))
     {
       width = height * 1024.0/768;
     }

     // IE fires onresize even when only font size is changed!
     // so we do a check to avoid blocking < and > actions
     if (width != w3c_slidy.last_width || height != w3c_slidy.last_height)
     {
       if (width >= 1100)
         w3c_slidy.size_index = 5;    // 4
       else if (width >= 1000)
         w3c_slidy.size_index = 4;    // 3
       else if (width >= 800)
         w3c_slidy.size_index = 3;    // 2
       else if (width >= 600)
         w3c_slidy.size_index = 2;    // 1
       else if (width)
         w3c_slidy.size_index = 0;

       // add in font size adjustment from meta element e.g.
       // <meta name="font-size-adjustment" content="-2" />
       // useful when slides have too much content ;-)

       if (0 <= w3c_slidy.size_index + w3c_slidy.size_adjustment &&
             w3c_slidy.size_index + w3c_slidy.size_adjustment < w3c_slidy.sizes.length)
         w3c_slidy.size_index = w3c_slidy.size_index + w3c_slidy.size_adjustment;

       // enables cross browser use of relative width/height
       // on object elements for use with SVG and Flash media
       w3c_slidy.adjust_object_dimensions(width, height);

       if (document.body.style.fontSize != w3c_slidy.sizes[w3c_slidy.size_index])
       {
         document.body.style.fontSize = w3c_slidy.sizes[w3c_slidy.size_index];
       }

       w3c_slidy.last_width = width;
       w3c_slidy.last_height = height;

       // force reflow to work around Mozilla bug
       if (w3c_slidy.ns_pos)
       {
         var slide = w3c_slidy.slides[w3c_slidy.slide_number];
         w3c_slidy.hide_slide(slide);
         w3c_slidy.show_slide(slide);
       }

       // force correct positioning of toolbar
       w3c_slidy.refresh_toolbar(200);
     }
  },

  scrolled: function () {
    if (w3c_slidy.toolbar && !w3c_slidy.ns_pos && !w3c_slidy.ie7)
    {
      w3c_slidy.hack_offset = w3c_slidy.scroll_x_offset();
      // hide toolbar
      w3c_slidy.toolbar.style.display = "none";

      // make it reappear later
      if (w3c_slidy.scrollhack == 0 && !w3c_slidy.view_all)
      {
        setTimeout(function () {w3c_slidy.show_toolbar(); }, 1000);
        w3c_slidy.scrollhack = 1;
      }
    }
  },

  hide_toolbar: function () {
    w3c_slidy.add_class(w3c_slidy.toolbar, "hidden");
    window.focus();
  },

  // used to ensure IE refreshes toolbar in correct position
  refresh_toolbar: function (interval) {
    if (!w3c_slidy.ns_pos && !w3c_slidy.ie7)
    {
      w3c_slidy.hide_toolbar();
      setTimeout(function () {w3c_slidy.show_toolbar(); }, interval);
    }
  },

  // restores toolbar after short delay
  show_toolbar: function () {
    if (w3c_slidy.want_toolbar)
    {
      w3c_slidy.toolbar.style.display = "block";

      if (!w3c_slidy.ns_pos)
      {
        // adjust position to allow for scrolling
        var xoffset = w3c_slidy.scroll_x_offset();
        w3c_slidy.toolbar.style.left = xoffset;
        w3c_slidy.toolbar.style.right = xoffset;

        // determine vertical scroll offset
        //var yoffset = scrollYOffset();

        // bottom is doc height - window height - scroll offset
        //var bottom = documentHeight() - lastHeight - yoffset

        //if (yoffset > 0 || documentHeight() > lastHeight)
        //   bottom += 16;  // allow for height of scrollbar

        w3c_slidy.toolbar.style.bottom = 0; //bottom;
      }

      w3c_slidy.remove_class(w3c_slidy.toolbar, "hidden");
    }

    w3c_slidy.scrollhack = 0;


    // set the keyboard focus to the help link on the
    // toolbar to ensure that document has the focus
    // IE doesn't always work with window.focus()
    // and this hack has benefit of Enter for help

    try
    {
      if (!w3c_slidy.opera)
        w3c_slidy.help_anchor.focus();
    }
    catch (e)
    {
    }
  },

// invoked via F key
  toggle_toolbar: function () {
    if (!w3c_slidy.view_all)
    {
      if (w3c_slidy.has_class(w3c_slidy.toolbar, "hidden"))
      {
        w3c_slidy.remove_class(w3c_slidy.toolbar, "hidden")
        w3c_slidy.want_toolbar = 1;
      }
      else
      {
        w3c_slidy.add_class(w3c_slidy.toolbar, "hidden")
        w3c_slidy.want_toolbar = 0;
      }
    }
  },

  scroll_x_offset: function () {
    if (window.pageXOffset)
      return self.pageXOffset;

    if (document.documentElement &&
             document.documentElement.scrollLeft)
      return document.documentElement.scrollLeft;

    if (document.body)
      return document.body.scrollLeft;

    return 0;
  },

  scroll_y_offset: function () {
    if (window.pageYOffset)
      return self.pageYOffset;

    if (document.documentElement &&
             document.documentElement.scrollTop)
      return document.documentElement.scrollTop;

    if (document.body)
      return document.body.scrollTop;

    return 0;
  },

  // looking for a way to determine height of slide content
  // the slide itself is set to the height of the window
  optimize_font_size: function () {
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];

    //var dh = documentHeight(); //getDocHeight(document);
    var dh = slide.scrollHeight;
    var wh = getWindowHeight();
    var u = 100 * dh / wh;

    alert("window utilization = " + u + "% (doc "
      + dh + " win " + wh + ")");
  },

  // from document object
  get_doc_height: function (doc) {
    if (!doc)
      doc = document;

    if (doc && doc.body && doc.body.offsetHeight)
      return doc.body.offsetHeight;  // ns/gecko syntax

    if (doc && doc.body && doc.body.scrollHeight)
      return doc.body.scrollHeight;

    alert("couldn't determine document height");
  },

  get_window_height: function () {
    if ( typeof( window.innerHeight ) == 'number' )
      return window.innerHeight;  // Non IE browser

    if (document.documentElement && document.documentElement.clientHeight)
      return document.documentElement.clientHeight;  // IE6

    if (document.body && document.body.clientHeight)
      return document.body.clientHeight; // IE4
  },

  document_height: function () {
    var sh, oh;

    sh = document.body.scrollHeight;
    oh = document.body.offsetHeight;

    if (sh && oh)
    {
      return (sh > oh ? sh : oh);
    }

    // no idea!
    return 0;
  },

  smaller: function () {
    if (w3c_slidy.size_index > 0)
    {
      --w3c_slidy.size_index;
    }

    w3c_slidy.toolbar.style.display = "none";
    document.body.style.fontSize = w3c_slidy.sizes[w3c_slidy.size_index];
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];
    w3c_slidy.hide_slide(slide);
    w3c_slidy.show_slide(slide);
    setTimeout(function () {w3c_slidy.show_toolbar(); }, 50);
  },

  bigger: function () {
    if (w3c_slidy.size_index < w3c_slidy.sizes.length - 1)
    {
      ++w3c_slidy.size_index;
    }

    w3c_slidy.toolbar.style.display = "none";
    document.body.style.fontSize = w3c_slidy.sizes[w3c_slidy.size_index];
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];
    w3c_slidy.hide_slide(slide);
    w3c_slidy.show_slide(slide);
    setTimeout(function () {w3c_slidy.show_toolbar(); }, 50);
  },

  // enables cross browser use of relative width/height
  // on object elements for use with SVG and Flash media
  // with thanks to Ivan Herman for the suggestion
  adjust_object_dimensions: function (width, height) {
    for( var i = 0; i < w3c_slidy.objects.length; i++ )
    {
      var obj = this.objects[i];
      var mimeType = obj.getAttribute("type");

      if (mimeType == "image/svg+xml" || mimeType == "application/x-shockwave-flash")
      {
        if ( !obj.initialWidth )
          obj.initialWidth = obj.getAttribute("width");

        if ( !obj.initialHeight )
          obj.initialHeight = obj.getAttribute("height");

        if ( obj.initialWidth && obj.initialWidth.charAt(obj.initialWidth.length-1) == "%" )
        {
          var w = parseInt(obj.initialWidth.slice(0, obj.initialWidth.length-1));
          var newW = width * (w/100.0);
          obj.setAttribute("width",newW);
        }

        if ( obj.initialHeight &&
             obj.initialHeight.charAt(obj.initialHeight.length-1) == "%" )
        {
          var h = parseInt(obj.initialHeight.slice(0, obj.initialHeight.length-1));
          var newH = height * (h/100.0);
          obj.setAttribute("height", newH);
        }
      }
    }
  },

  // needed for Opera to inhibit default behavior
  // since Opera delivers keyPress even if keyDown
  // was cancelled
  key_press: function (event) {
    if (!event)
      event = window.event;

    if (!w3c_slidy.key_wanted)
      return w3c_slidy.cancel(event);

    return true;
  },

  //  See e.g. http://www.quirksmode.org/js/events/keys.html for keycodes
  key_down: function (event) {
    var key, target, tag;

    w3c_slidy.key_wanted = true;

    if (!event)
      event = window.event;

    // kludge around NS/IE differences
    if (window.event)
    {
      key = window.event.keyCode;
      target = window.event.srcElement;
    }
    else if (event.which)
    {
      key = event.which;
      target = event.target;
    }
    else
      return true; // Yikes! unknown browser

    // ignore event if key value is zero
    // as for alt on Opera and Konqueror
    if (!key)
       return true;

    // avoid interfering with keystroke
    // behavior for non-slidy chrome elements
    if (!w3c_slidy.slidy_chrome(target) &&
        w3c_slidy.special_element(target))
      return true;

    // check for concurrent control/command/alt key
    // but are these only present on mouse events?

    if (event.ctrlKey || event.altKey || event.metaKey)
       return true;

    // dismiss table of contents if visible
    if (w3c_slidy.is_shown_toc() && key != 9 && key != 16 && key != 38 && key != 40)
    {
      w3c_slidy.hide_table_of_contents(true);

      if (key == 27 || key == 84 || key == 67)
        return w3c_slidy.cancel(event);
    }

    if (key == 34) // Page Down
    {
      if (w3c_slidy.view_all)
        return true;

      w3c_slidy.next_slide(false);
      return w3c_slidy.cancel(event);
    }
    else if (key == 33) // Page Up
    {
      if (w3c_slidy.view_all)
        return true;

      w3c_slidy.previous_slide(false);
      return w3c_slidy.cancel(event);
    }
    else if (key == 32) // space bar
    {
      w3c_slidy.next_slide(true);
      return w3c_slidy.cancel(event);
    }
    else if (key == 37) // Left arrow
    {
      w3c_slidy.previous_slide(!event.shiftKey);
      return w3c_slidy.cancel(event);
    }
    else if (key == 36) // Home
    {
      w3c_slidy.first_slide();
      return w3c_slidy.cancel(event);
    }
    else if (key == 35) // End
    {
      w3c_slidy.last_slide();
      return w3c_slidy.cancel(event);
    }
    else if (key == 39) // Right arrow
    {
      w3c_slidy.next_slide(!event.shiftKey);
      return w3c_slidy.cancel(event);
    }
    else if (key == 13) // Enter
    {
      if (w3c_slidy.outline)
      {
        if (w3c_slidy.outline.visible)
          w3c_slidy.fold(w3c_slidy.outline);
        else
          w3c_slidy.unfold(w3c_slidy.outline);

       return w3c_slidy.cancel(event);
      }
    }
    else if (key == 188)  // < for smaller fonts
    {
      w3c_slidy.smaller();
      return w3c_slidy.cancel(event);
    }
    else if (key == 190)  // > for larger fonts
    {
      w3c_slidy.bigger();
      return w3c_slidy.cancel(event);
    }
    else if (key == 189 || key == 109)  // - for smaller fonts
    {
      w3c_slidy.smaller();
      return w3c_slidy.cancel(event);
    }
    else if (key == 187 || key == 191 || key == 107)  // = +  for larger fonts
    {
      w3c_slidy.bigger();
      return w3c_slidy.cancel(event);
    }
    else if (key == 83)  // S for smaller fonts
    {
      w3c_slidy.smaller();
      return w3c_slidy.cancel(event);
    }
    else if (key == 66)  // B for larger fonts
    {
      w3c_slidy.bigger();
      return w3c_slidy.cancel(event);
    }
    else if (key == 90)  // Z for last slide
    {
      w3c_slidy.last_slide();
      return w3c_slidy.cancel(event);
    }
    else if (key == 70)  // F for toggle toolbar
    {
      w3c_slidy.toggle_toolbar();
      return w3c_slidy.cancel(event);
    }
    else if (key == 65)  // A for toggle view single/all slides
    {
      w3c_slidy.toggle_view();
      return w3c_slidy.cancel(event);
    }
    else if (key == 75)  // toggle action of left click for next page
    {
      w3c_slidy.mouse_click_enabled = !w3c_slidy.mouse_click_enabled;
      var alert_msg = (w3c_slidy.mouse_click_enabled ?
                "enabled" : "disabled") +  " mouse click advance";

      alert(w3c_slidy.localize(alert_msg));
      return w3c_slidy.cancel(event);
    }
    else if (key == 84 || key == 67)  // T or C for table of contents
    {
      if (w3c_slidy.toc)
        w3c_slidy.toggle_table_of_contents();

      return w3c_slidy.cancel(event);
    }
    else if (key == 72) // H for help
    {
      window.location = w3c_slidy.help_page;
      return w3c_slidy.cancel(event);
    }
//jmi
    else if (key == 73) // I to toggle incremental display
    {
      var slide = w3c_slidy.slides[w3c_slidy.slide_number];
      w3c_slidy.hide_slide(slide);
      if (w3c_slidy.incremental_display) { w3c_slidy.set_visibility_all_incremental("visible"); }
      w3c_slidy.incremental_display = !w3c_slidy.incremental_display ;
      w3c_slidy.last_shown = null ;
      w3c_slidy.set_visibility_all_incremental("hidden");
      //this.set_eos_status(true);
      w3c_slidy.show_slide(slide);
      return w3c_slidy.cancel(event);
    }
    else if (key == 76) // L to toggle color-set
    {
      w3c_slidy.toggle_color_set();
      return w3c_slidy.cancel(event);
    }
    else if (key == 77) // display help_keymap
    {
      alert(w3c_slidy.help_keymap);
      return w3c_slidy.cancel(event);
    }
//jmi end
     //else alert("key code is "+ key);
    return true;
  },

  // safe for both text/html and application/xhtml+xml
  create_element: function (name) {
    if (this.xhtml && (typeof document.createElementNS != 'undefined'))
      return document.createElementNS("http://www.w3.org/1999/xhtml", name)

    return document.createElement(name);
  },

  get_element_style: function (elem, IEStyleProp, CSSStyleProp) {
    if (elem.currentStyle)
    {
      return elem.currentStyle[IEStyleProp];
    }
    else if (window.getComputedStyle)
    {
      var compStyle = window.getComputedStyle(elem, "");
      return compStyle.getPropertyValue(CSSStyleProp);
    }
    return "";
  },

  // the string str is a whitespace separated list of tokens
  // test if str contains a particular token, e.g. "slide"
  has_token: function (str, token) {
    if (str)
    {
      // define pattern as regular expression
      var pattern = /\w+/g;

      // check for matches
      // place result in array
      var result = str.match(pattern);

      // now check if desired token is present
      for (var i = 0; i < result.length; i++)
      {
        if (result[i] == token)
          return true;
      }
    }

    return false;
  },

  get_class_list: function (element) {
    if (typeof element.className != 'undefined')
      return element.className;

    return element.getAttribute("class");
  },

  has_class: function (element, name) {
    if (element.nodeType != 1)
      return false;

    var regexp = new RegExp("(^| )" + name + "\W*");

    if (typeof element.className != 'undefined')
      return regexp.test(element.className);

    return regexp.test(element.getAttribute("class"));
  },

  remove_class: function (element, name) {
    var regexp = new RegExp("(^| )" + name + "\W*");
    var clsval = "";

    if (typeof element.className != 'undefined')
    {
      clsval = element.className;

      if (clsval)
      {
        clsval = clsval.replace(regexp, "");
        element.className = clsval;
      }
    }
    else
    {
      clsval = element.getAttribute("class");

      if (clsval)
      {
        clsval = clsval.replace(regexp, "");
        element.setAttribute("class", clsval);
      }
    }
  },

  add_class: function (element, name) {
    if (!this.has_class(element, name))
    {
      if (typeof element.className != 'undefined')
        element.className += " " + name;
      else
      {
        var clsval = element.getAttribute("class");
        clsval = clsval ? clsval + " " + name : name;
        element.setAttribute("class", clsval);
      }
    }
  },

  // HTML elements that can be used with class="incremental"
  // note that you can also put the class on containers like
  // up, ol, dl, and div to make their contents appear
  // incrementally. Upper case is used since this is what
  // browsers report for HTML node names (text/html).
  incremental_elements: null,
  okay_for_incremental: function (name) {
    if (!this.incremental_elements)
    {
      var inclist = new Array();
      inclist["p"] = true;
      inclist["pre"] = true;
      inclist["li"] = true;
      inclist["blockquote"] = true;
      inclist["dt"] = true;
      inclist["dd"] = true;
      inclist["h2"] = true;
      inclist["h3"] = true;
      inclist["h4"] = true;
      inclist["h5"] = true;
      inclist["h6"] = true;
      inclist["span"] = true;
      inclist["address"] = true;
      inclist["table"] = true;
      inclist["tr"] = true;
      inclist["th"] = true;
      inclist["td"] = true;
      inclist["img"] = true;
      inclist["object"] = true;
      this.incremental_elements = inclist;
    }
    return this.incremental_elements[name.toLowerCase()];
  },

  next_incremental_item: function (node) {
    var br = this.is_xhtml ? "br" : "BR";
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];

    for (;;)
    {
      node = w3c_slidy.next_node(slide, node);

      if (node == null || node.parentNode == null)
        break;

      if (node.nodeType == 1)  // ELEMENT
      {
        if (node.nodeName == br)
          continue;

        if (w3c_slidy.has_class(node, "incremental")
             && w3c_slidy.okay_for_incremental(node.nodeName))
          return node;

        if (w3c_slidy.has_class(node.parentNode, "incremental")
             && !w3c_slidy.has_class(node, "non-incremental"))
          return node;
      }
    }

    return node;
  },

  previous_incremental_item: function (node) {
    var br = this.is_xhtml ? "br" : "BR";
    var slide = w3c_slidy.slides[w3c_slidy.slide_number];

    for (;;)
    {
      node = w3c_slidy.previous_node(slide, node);

      if (node == null || node.parentNode == null)
        break;

      if (node.nodeType == 1)
      {
        if (node.nodeName == br)
          continue;

        if (w3c_slidy.has_class(node, "incremental")
             && w3c_slidy.okay_for_incremental(node.nodeName))
          return node;

        if (w3c_slidy.has_class(node.parentNode, "incremental")
             && !w3c_slidy.has_class(node, "non-incremental"))
          return node;
      }
    }

    return node;
  },

  // set visibility for all elements on current slide with
  // a parent element with attribute class="incremental"
  set_visibility_all_incremental: function (value) {
    var node = this.next_incremental_item(null);

//jmi
if (!w3c_slidy.incremental_display) {value = "visible";}

    if (value == "hidden")
    {
      while (node)
      {
        w3c_slidy.add_class(node, "invisible");
        node = w3c_slidy.next_incremental_item(node);
      }
    }
    else // value == "visible"
    {
      while (node)
      {
        w3c_slidy.remove_class(node, "invisible");
        node = w3c_slidy.next_incremental_item(node);
      }
    }
  },

  // reveal the next hidden item on the slide
  // node is null or the node that was last revealed
  reveal_next_item: function (node) {
    node = w3c_slidy.next_incremental_item(node);

    if (node && node.nodeType == 1)  // an element
      w3c_slidy.remove_class(node, "invisible");

    return node;
  },

  // exact inverse of revealNextItem(node)
  hide_previous_item: function (node) {
    if (node && node.nodeType == 1)  // an element
      w3c_slidy.add_class(node, "invisible");

    return this.previous_incremental_item(node);
  },

  // left to right traversal of root's content
  next_node: function (root, node) {
    if (node == null)
      return root.firstChild;

    if (node.firstChild)
      return node.firstChild;

    if (node.nextSibling)
      return node.nextSibling;

    for (;;)
    {
      node = node.parentNode;

      if (!node || node == root)
        break;

      if (node && node.nextSibling)
        return node.nextSibling;
    }

    return null;
  },

  // right to left traversal of root's content
  previous_node: function (root, node) {
    if (node == null)
    {
      node = root.lastChild;

      if (node)
      {
        while (node.lastChild)
          node = node.lastChild;
      }

      return node;
    }

    if (node.previousSibling)
    {
      node = node.previousSibling;

      while (node.lastChild)
        node = node.lastChild;

      return node;
    }

    if (node.parentNode != root)
      return node.parentNode;

    return null;
  },

  previous_sibling_element: function (el) {
    el = el.previousSibling;

    while (el && el.nodeType != 1)
      el = el.previousSibling;

    return el;
  },

  next_sibling_element: function (el) {
    el = el.nextSibling;

    while (el && el.nodeType != 1)
      el = el.nextSibling;

    return el;
  },

  first_child_element: function (el) {
    var node;

    for (node = el.firstChild; node; node = node.nextSibling)
    {
      if (node.nodeType == 1)
        break;
    }

    return node;
  },

  first_tag: function (element, tag) {
    var node;

    if (!this.is_xhtml)
      tag = tag.toUpperCase();

    for (node = element.firstChild; node; node = node.nextSibling)
    {
      if (node.nodeType == 1 && node.nodeName == tag)
        break;
    }

    return node;
  },

  hide_selection: function () {
    if (window.getSelection) // Firefox, Chromium, Safari, Opera
    {
      var selection = window.getSelection();

      if (selection.rangeCount > 0)
      {
        var range = selection.getRangeAt(0);
        range.collapse (false);
      }
    }
    else // Internet Explorer
    {
      var textRange = document.selection.createRange ();
      textRange.collapse (false);
    }
  },

  get_selected_text: function () {
    try
    {
      if (window.getSelection)
        return window.getSelection().toString();

      if (document.getSelection)
        return document.getSelection().toString();

      if (document.selection)
        return document.selection.createRange().text;
    }
    catch (e)
    {
    }

    return "";
  },

  // make note of length of selected text
  // as this evaluates to zero in click event
  mouse_button_up: function (e) {
    w3c_slidy.selected_text_len = w3c_slidy.get_selected_text().length;
  },

  // right mouse button click is reserved for context menus
  // it is more reliable to detect rightclick than leftclick
  mouse_button_click: function (e) {
    var rightclick = false;
    var leftclick = false;
    var middleclick = false;
    var target;

    if (!e)
      var e = window.event;

    if (e.target)
      target = e.target;
    else if (e.srcElement)
      target = e.srcElement;

    // work around Safari bug
    if (target.nodeType == 3)
      target = target.parentNode;

    if (e.which) // all browsers except IE
    {
      leftclick = (e.which == 1);
      middleclick = (e.which == 2);
      rightclick = (e.which == 3);
    }
    else if (e.button)
    {
      // Konqueror gives 1 for left, 4 for middle
      // IE6 gives 0 for left and not 1 as I expected

      if (e.button == 4)
        middleclick = true;

      // all browsers agree on 2 for right button
      rightclick = (e.button == 2);
    }
    else
      leftclick = true;

    if (w3c_slidy.selected_text_len > 0)
    {
      w3c_slidy.stop_propagation(e);
      e.cancel = true;
      e.returnValue = false;
      return false;
    }

    // dismiss table of contents
    w3c_slidy.hide_table_of_contents(false);

    // check if target is something that probably want's clicks
    // e.g. a, embed, object, input, textarea, select, option
    var tag = target.nodeName.toLowerCase();

    if (w3c_slidy.mouse_click_enabled && leftclick &&
        !w3c_slidy.special_element(target) &&
        !target.onclick)
    {
      w3c_slidy.next_slide(true);
      w3c_slidy.stop_propagation(e);
      e.cancel = true;
      e.returnValue = false;
      return false;
    }

    return true;
  },

  special_element: function (e) {
    var tag = e.nodeName.toLowerCase();

    return e.onkeydown ||
      e.onclick ||
      tag == "a" ||
      tag == "embed" ||
      tag == "object" ||
      tag == "video" ||
      tag == "audio" ||
      tag == "input" ||
      tag == "textarea" ||
      tag == "select" ||
      tag == "option";
  },

  slidy_chrome: function (el) {
    while (el)
    {
      if (el == w3c_slidy.toc ||
          el == w3c_slidy.toolbar ||
          w3c_slidy.has_class(el, "outline"))
        return true;

      el = el.parentNode;
    }

    return false;
  },

  get_key: function (e)
  {
    var key;

    // kludge around NS/IE differences
    if (typeof window.event != "undefined")
      key = window.event.keyCode;
    else if (e.which)
      key = e.which;

    return key;
  },

  get_target: function (e) {
    var target;

    if (!e)
      e = window.event;

    if (e.target)
      target = e.target;
    else if (e.srcElement)
      target = e.srcElement;

    if (target.nodeType != 1)
      target = target.parentNode;

    return target;
  },

  // does display property provide correct defaults?
  is_block: function (elem) {
    var tag = elem.nodeName.toLowerCase();

    return tag == "ol" || tag == "ul" || tag == "p" ||
           tag == "li" || tag == "table" || tag == "pre" ||
           tag == "h1" || tag == "h2" || tag == "h3" ||
           tag == "h4" || tag == "h5" || tag == "h6" ||
           tag == "blockquote" || tag == "address";
  },

  add_listener: function (element, event, handler) {
    if (window.addEventListener)
      element.addEventListener(event, handler, false);
    else
      element.attachEvent("on"+event, handler);
  },

  // used to prevent event propagation from field controls
  stop_propagation: function (event) {
    event = event ? event : window.event;
    event.cancelBubble = true;  // for IE

    if (event.stopPropagation)
      event.stopPropagation();

    return true;
  },

  cancel: function (event) {
    if (event)
    {
       event.cancel = true;
       event.returnValue = false;

      if (event.preventDefault)
        event.preventDefault();
    }

    w3c_slidy.key_wanted = false;
    return false;
  },
// jmi
  init_color_sets: function(){
   if (this.color_sets.length == 0){
     // initialize color_sets array
     var tmp = document.styleSheets;
     var j = 0;
     for (var i=0;i<tmp.length;i++) {
       var css_name = null ;
       if (tmp[i].title) {
	css_name = tmp[i].title ;
       }
       if ((tmp[i].href) && (tmp[i].href.indexOf('.css') != -1)) {
	css_name = tmp[i].href.substring(tmp[i].href.lastIndexOf('/')+1,tmp[i].href.indexOf('.css')) ;
       }
	if ((css_name) && (css_name.indexOf('color_set') > 0)) {
         this.color_sets[j] = tmp[i];
         this.color_sets[j++].disabled = true;
	}
     }
     if (this.color_sets.length > 0){ this.color_sets[0].disabled = false; }
   }
  },
  toggle_color_set: function(){
   // toggle to the next color_set
   if (this.color_sets.length > 0){
    var i = 0;
    while ((i < this.color_sets.length) && (this.color_sets[i].disabled == true)) { i = i + 1 ; }
    if (i == this.color_sets.length) { i = i - 1; }
    this.color_sets[i].disabled = true ;
    this.color_sets[(i + 1) % (this.color_sets.length)].disabled = false ;
   }
  },

// for each language define an associative array
// and also the help text which is longer

  strings_es: {
    "slide":"pg.",
    "help?":"Ayuda",
    "contents?":"ndice",
    "table of contents":"tabla de contenidos",
    "Table of Contents":"Tabla de Contenidos",
    "restart presentation":"Reiniciar presentacin",
    "restart?":"Inicio"
  },
  help_es:
    "Utilice el ratn, barra espaciadora, teclas Izda/Dcha, " +
    "o Re pg y Av pg. Use S y B para cambiar el tamao de fuente.",

  strings_ca: {
    "slide":"pg..",
    "help?":"Ajuda",
    "contents?":"ndex",
    "table of contents":"taula de continguts",
    "Table of Contents":"Taula de Continguts",
    "restart presentation":"Reiniciar presentaci",
    "restart?":"Inici"
  },
  help_ca:
    "Utilitzi el ratol, barra espaiadora, tecles Esq./Dta. " +
    "o Re pg y Av pg. Usi S i B per canviar grandria de font.",

  strings_cs: {
    "slide":"snmek",
    "help?":"npovda",
    "contents?":"obsah",
    "table of contents":"obsah prezentace",
    "Table of Contents":"Obsah prezentace",
    "restart presentation":"znovu spustit prezentaci",
    "restart?":"restart"
  },
  help_cs:
    "Prezentaci mete prochzet pomoc kliknut myi, mezernku, " +
    "ipek vlevo a vpravo nebo klves PageUp a PageDown. Psmo se " +
    "d zvtit a zmenit pomoc klves B a S.",

  strings_nl: {
    "slide":"pagina",
    "help?":"Help?",
    "contents?":"Inhoud?",
    "table of contents":"inhoudsopgave",
    "Table of Contents":"Inhoudsopgave",
    "restart presentation":"herstart presentatie",
    "restart?":"Herstart?"
  },
  help_nl:
     "Navigeer d.m.v. het muis, spatiebar, Links/Rechts toetsen, " +
     "of PgUp en PgDn. Gebruik S en B om de karaktergrootte te veranderen.",

  strings_de: {
    "slide":"Seite",
    "help?":"Hilfe",
    "contents?":"bersicht",
    "table of contents":"Inhaltsverzeichnis",
    "Table of Contents":"Inhaltsverzeichnis",
    "restart presentation":"Prsentation neu starten",
    "restart?":"Neustart"
  },
  help_de:
    "Benutzen Sie die Maus, Leerschlag, die Cursortasten links/rechts oder " +
    "Page up/Page Down zum Wechseln der Seiten und S und B fr die Schriftgrsse.",

  strings_pl: {
    "slide":"slajd",
    "help?":"pomoc?",
    "contents?":"spis treci?",
    "table of contents":"spis treci",
    "Table of Contents":"Spis Treci",
    "restart presentation":"Restartuj prezentacj",
    "restart?":"restart?"
  },
  help_pl:
    "Zmieniaj slajdy klikajc mysz, naciskajc spacj, strzaki lewo/prawo" +
    "lub PgUp / PgDn. Uyj klawiszy S i B, aby zmieni rozmiar czczionki.",

  strings_fr: {
    "slide":"page",
    "help?":"Aide",
    "contents?":"Index",
    "table of contents":"table des matires",
    "Table of Contents":"Table des matires",
    "restart presentation":"Recommencer l'expos",
    "restart?":"Dbut"
  },
  help_fr:
    "Naviguez avec la souris, la barre d'espace, les flches " +
    "gauche/droite ou les touches Pg Up, Pg Dn. Utilisez " +
    "les touches S et B pour modifier la taille de la police, M pour l'association des touches.",

  strings_hu: {
    "slide":"oldal",
    "help?":"segtsg",
    "contents?":"tartalom",
    "table of contents":"tartalomjegyzk",
    "Table of Contents":"Tartalomjegyzk",
    "restart presentation":"bemutat jraindtsa",
    "restart?":"jraindts"
  },
  help_hu:
    "Az oldalak kzti lpkedshez kattintson az egrrel, vagy " +
    "hasznlja a szkz, a bal, vagy a jobb nyl, illetve a Page Down, " +
    "Page Up billentyket. Az S s a B billentykkel vltoztathatja " +
    "a szveg mrett.",

  strings_it: {
    "slide":"pag.",
    "help?":"Aiuto",
    "contents?":"Indice",
    "table of contents":"indice",
    "Table of Contents":"Indice",
    "restart presentation":"Ricominciare la presentazione",
    "restart?":"Inizio"
  },
  help_it:
    "Navigare con mouse, barra spazio, frecce sinistra/destra o " +
    "PgUp e PgDn. Usare S e B per cambiare la dimensione dei caratteri.",

  strings_el: {
    "slide":"",
    "help?":";",
    "contents?":";",
    "table of contents":" ",
    "Table of Contents":" ",
    "restart presentation":" ",
    "restart?":";"
  },
  help_el:
    "     ,  space,   /, " +
    " Page Up  Page Down.    S  B    " +
    "   .",

  strings_ja: {
    "slide":"",
    "help?":"",
    "contents?":"",
    "table of contents":"",
    "Table of Contents":"",
    "restart presentation":"",
    "restart?":""
  },
  help_ja:
     "     " +
     " Page Up  Page Down S  B",

  strings_zh: {
    "slide":"",
    "help?":"?",
    "contents?":"?",
    "table of contents":"",
    "Table of Contents":"",
    "restart presentation":"",
    "restart?":"?"
  },
  help_zh:
    ", , , Pg Up  Pg Dn . " +
    " S, B .",

  strings_ru: {
    "slide":"",
    "help?":"?",
    "contents?":"?",
    "table of contents":"",
    "Table of Contents":"",
    "restart presentation":" ",
    "restart?":"?"
  },
  help_ru:
    "  ,   , " +
    "/  Pg Up  Pg Dn.  S  B   .",

  strings_sv: {
    "slide":"sida",
    "help?":"hjlp",
    "contents?":"innehll",
    "table of contents":"innehllsfrteckning",
    "Table of Contents":"Innehllsfrteckning",
    "restart presentation":"visa presentationen frn brjan",
    "restart?":"brja om"
  },
  help_sv:
    "Blddra med ett klick med vnstra musknappen, mellanslagstangenten, " +
    "vnster- och hgerpiltangenterna eller tangenterna Pg Up, Pg Dn. " +
    "Anvnd tangenterna S och B fr att ndra textens storlek.",

  strings: { },

  localize: function (src) {
    if (src == "")
      return src;

     // try full language code, e.g. en-US
     var s, lookup = w3c_slidy.strings[w3c_slidy.lang];

     if (lookup)
     {
       s = lookup[src];

       if (s)
        return s;
     }

     // strip country code suffix, e.g.
     // try en if undefined for en-US
     var lg = w3c_slidy.lang.split("-");

     if (lg.length > 1)
     {
       lookup = w3c_slidy.strings[lg[0]];

       if (lookup)
       {
         s = lookup[src];

         if (s)
          return s;
       }
     }

     // otherwise string as is
     return src;
  },

  init_localization: function () {
    var i18n = w3c_slidy;
    var help_text = w3c_slidy.help_text;

    // each such language array is declared in the localize array
    // this is used as in  w3c_slidy.localize("foo");
    this.strings = {
      "es":this.strings_es,
      "ca":this.strings_ca,
      "cs":this.strings_cs,
      "nl":this.strings_nl,
      "de":this.strings_de,
      "pl":this.strings_pl,
      "fr":this.strings_fr,
      "hu":this.strings_hu,
      "it":this.strings_it,
      "el":this.strings_el,
      "jp":this.strings_ja,
      "zh":this.strings_zh,
      "ru":this.strings_ru,
      "sv":this.strings_sv
    },

    i18n.strings_es[help_text] = i18n.help_es;
    i18n.strings_ca[help_text] = i18n.help_ca;
    i18n.strings_cs[help_text] = i18n.help_cs;
    i18n.strings_nl[help_text] = i18n.help_nl;
    i18n.strings_de[help_text] = i18n.help_de;
    i18n.strings_pl[help_text] = i18n.help_pl;
    i18n.strings_fr[help_text] = i18n.help_fr;
    i18n.strings_hu[help_text] = i18n.help_hu;
    i18n.strings_it[help_text] = i18n.help_it;
    i18n.strings_el[help_text] = i18n.help_el;
    i18n.strings_ja[help_text] = i18n.help_ja;
    i18n.strings_zh[help_text] = i18n.help_zh;
    i18n.strings_ru[help_text] = i18n.help_ru;
    i18n.strings_sv[help_text] = i18n.help_sv;

    w3c_slidy.lang = document.body.parentNode.getAttribute("lang");

    if (!w3c_slidy.lang)
      w3c_slidy.lang = document.body.parentNode.getAttribute("xml:lang");

    if (!w3c_slidy.lang)
      w3c_slidy.lang = "en";
  }
};

// hack for back button behavior
if (w3c_slidy.ie6 || w3c_slidy.ie7)
{
  document.write("<iframe id='historyFrame' " +
  "src='javascript:\"<html"+"></"+"html>\"' " +
  "height='1' width='1' " +
  "style='position:absolute;left:-800px'></iframe>");
}

// attach event listeners for initialization
w3c_slidy.set_up();

// hide the slides as soon as body element is available
// to reduce annoying screen mess before the onload event
setTimeout(w3c_slidy.hide_slides, 50);

/*]]>*/
</script>
</head>
<body class="article">
<div id="header" class="slide asciidocslidy">
<h1>PR995293 technotes</h1>
<span id="author">Ping Song</span><br />
<span id="email"><tt>&lt;<a href="mailto:pings@juniper.net">pings@juniper.net</a>&gt;</tt></span><br />
<span id="revdate">Aug 2014</span>
</div>
<div class="slide asciidocslidy">
<div id="preamble">
<h1 style="visibility: hidden;">Preamble</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="Preamble";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="dlist"><dl class="">
<dt class="hdlist1">
TOC
</dt>
<dd>
<ul class="">
<li>
<span>
|preface
</span>
</li>
<li>
<span>
|initial symptoms
</span>
</li>
<li>
<span>
|Multicast (control plane) issues?
</span>
</li>
<li>
<span>
|PFE (MS-PIC) forwarding plane issue?
</span>
</li>
<li>
<span>
|the <code>resolve no route</code> traffic
</span>
</li>
<li>
<span>
|A BGP issue?
</span>
</li>
<li>
<span>
|A TCP problem?
</span>
</li>
<li>
<span>
|A full picture: timeline in the pcap capture
</span>
</li>
<li>
<span>
|the full story
</span>
</li>
<li>
<span>
|extra stuff
</span>
</li>
</ul>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_preface">preface</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="preface";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="tableblock">
<table rules="none"
width="80%"
frame="void"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">PR995293 <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[1] : for some reason, most of the later discussions were offline with email/conf calls ,hence not updated in the PR system</div>" ;/*]]>*/</script>
[1]
once became really hot and evolved as a battle between Juniper and Cisco. a lot
of efforts from various teams (Multicast, routing, TCP) and expert/DEs were
involved.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">So I was just attempting to summarize some of the "key info" we got during the
investigations and put them into a
draft <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[2] : this is currently a live doc and need more polishing works</div>" ;/*]]>*/</script>
[2]
- just in case this may be also useful for later reference&#8230;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">
<div class="tableblock">
<table rules="none"
width="80%"
frame="void"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">this document was prepared based on all discussions/email
exchanges/investigations about this issue.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Some of the information/analysis/troubleshooting steps/conclusions/etc were
quoted directly from DE&#8217;s comments. <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[3] : see <a href="#appendix">[appendix]</a> for a list of the DE&#8217;s name</div>" ;/*]]>*/</script>
[3]</p></td>
</tr>
</tbody>
</table>
</div>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_the_initial_symptoms">the initial symptoms</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="the initial symptoms";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>After GRES, Mcast traffic is not stable.</p>
</div>
<div class="paragraph">
<p>For example, data is going up and down
for (150.150.150.x,238.1.1.78), which sourced from desttg1005me2, for all
remote receivers (even for the local receivers).</p>
</div>
<div class="paragraph">
<p>Customer was sending 20 (s,g) and each with 5 pps.</p>
</div>
<div class="verseblock">
<div class="title">customer&#8217;s original issue description</div>
<pre class="content">seeing data goin up and down after RE switchover and will not stop

It has been 50 minutes since the RE switchover, I am still seeing data going up
and down although there is no krt queue problem.</pre>
<div class="attribution">
<em>May 21 2014 email</em><br />
&#8212; Sarah Yu
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_summary_of_the_symptoms"> summary of the symptoms</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" summary of the symptoms";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
end to end mVPN traffic data lost
</span>
</li>
<li>
<span>
only triggered after GRES
</span>
</li>
<li>
<span>
(RPD) high CPU usage sometime
</span>
</li>
<li>
<span>
issue is NOT transient, not persistent forever, will last for a while once seen
</span>
</li>
<li>
<span>
much more easily triggered when running cron scripts to toggle configuration
</span>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_topology_simplified"> topology (simplified)</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" topology (simplified)";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>       +---------------+    +-------+
DUT==&gt; | 10.64.0.94    +----+       |
       | desttg1005me2 |    |       |
       +---------------+    |       |
   &lt;====================================&gt;
                            |       |
       +---------------+    |       |
       | 10.144.10.91  +----+       |
       | sfpjar2       |    |       |
       +---------------+    |       |
                            |       |
                            | core  |
       +---------------+    |       |
       | 10.144.10.81  +----+       |
       | nypjar2       |    |       |
       +---------------+    |       |
                            |       |
       +---------------+    |       |
       | 10.64.0.96    +----+       |
       | defrnk1007me2 |    |       |
       +---------------+    |       |
                            |       |
                            |       |
       +---------------+    |       |
       | 10.144.10.90  +----+       |
       | chpjar1       |    |       |
       +---------------+    +-------+</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_mvpn_data_loss"> mVPN data loss</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" mVPN data loss";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>sarahyu@SFPJAR2-re1&gt; show multicast route instance 13979:11001 extensive inet | find 150.150 | match "source|pps"
May 21 13:52:33
    Source: 150.150.150.2/32
    Statistics: 1 kBps, 5 pps, 10605 packets
    Source: 150.150.150.3/32
    Statistics: 1 kBps, 5 pps, 10895 packets
    Source: 150.150.150.4/32
    Statistics: 1 kBps, 5 pps, 10397 packets
    Source: 150.150.150.5/32
    Statistics: 1 kBps, 5 pps, 10022 packets
    Source: 150.150.150.6/32
    Statistics: 0 kBps, 0 pps, 2120 packets
    Source: 150.150.150.8/32
    Statistics: 1 kBps, 5 pps, 10333 packets
    Source: 150.150.150.9/32
    Statistics: 1 kBps, 5 pps, 10158 packets
    Source: 150.150.150.10/32
    Statistics: 1 kBps, 5 pps, 10939 packets
    Source: 150.150.150.11/32
    Statistics: 1 kBps, 5 pps, 9864 packets
    Source: 150.150.150.12/32
    Statistics: 1 kBps, 5 pps, 10006 packets
    Source: 150.150.150.13/32
    Statistics: 0 kBps, 0 pps, 10048 packets  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; 0 pps
    Source: 150.150.150.14/32
    Statistics: 1 kBps, 5 pps, 10601 packets
    Source: 150.150.150.15/32
    Statistics: 1 kBps, 5 pps, 10932 packets
    Source: 150.150.150.16/32
    Statistics: 1 kBps, 5 pps, 9714 packets
    Source: 150.150.150.17/32
    Statistics: 0 kBps, 0 pps, 9848 packets  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; 0 pps
    Source: 150.150.150.18/32
    Statistics: 0 kBps, 0 pps, 2162 packets
    Source: 150.150.150.19/32
    Statistics: 1 kBps, 5 pps, 10601 packets
    Source: 150.150.150.20/32
    Statistics: 1 kBps, 5 pps, 10935 packets
    Source: 150.150.150.21/32
Statistics: 1 kBps, 5 pps, 10045 packets</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_what_is_the_test"> what is the test</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" what is the test";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="dlist"><dl class="">
<dt class="hdlist1">
Router reload first
</dt>
<dd>
</dd>
</dl></div>
<div class="listingblock">
<div class="content">
<pre><tt>sarahyu@DESTTG1005ME2-re1&gt; request system reboot both-routing-engines
May 21 12:50:13
Reboot the system ? [yes,no] (no) yes
May 21 12:50:15</tt></pre>
</div></div>
<div class="dlist"><dl class="">
<dt class="hdlist1">
RE switchover
</dt>
<dd>
</dd>
</dl></div>
<div class="listingblock">
<div class="content">
<pre><tt>sarahyu@DESTTG1005ME2-re0&gt; request chassis routing-engine master switch
May 21 13:16:52
Toggle mastership between routing engines ? [yes,no] (no) yes May 21 13:16:55</tt></pre>
</div></div>
<div class="dlist"><dl class="">
<dt class="hdlist1">
RPD high CPU
</dt>
<dd>
</dd>
</dl></div>
<div class="listingblock">
<div class="content">
<pre><tt>sarahyu@DESTTG1005ME2-re1&gt; show system processes summary
May 21 13:54:05
last pid: 37841;  load averages:  2.03,  1.96,  1.89  up 0+01:02:35    13:54:06
153 processes: 4 running, 133 sleeping, 1 zombie, 15 waiting

Mem: 726M Active, 382M Inact, 236M Wired, 1257M Cache, 214M Buf, 12G Free
Swap: 8192M Total, 8192M Free

  PID USERNAME       THR PRI NICE   SIZE    RES STATE    TIME   WCPU COMMAND
3727 root             2 132    0   443M   409M RUN      9:15 51.37% rpd
   11 root             1 171   52     0K    16K RUN     30:13  5.37% idle</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_multicast_control_plane_issues">Multicast (control plane) issues?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="Multicast (control plane) issues?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>the issue was originally analyzed from the multicast control plane point of
view, the symptoms are:</p>
</div>
<ul class="">
<li>
<span>
the <strong>C-pim neighborship flaps</strong> whenever the issue appears.
</span>
</li>
<li>
<span>
core PIM works fine
</span>
</li>
</ul>
<div class="listingblock">
<div class="title">pim neighborship (after GRES):</div>
<div class="content">
<pre><tt>{master}
j-tac-ps1@DESTTG1005ME2-re0> show pim neighbors instance 13979:11001 | no-more | match mt
mt-3/0/0.32855       4 2             HPG        00:02:34 10.64.0.64
mt-3/0/0.32855       4 2             HPLG       00:04:06 10.64.0.78
mt-3/0/0.32855       4 2             HPG        00:26:48 10.64.0.92
mt-3/0/0.32855       4 2             HPLG       00:03:03 10.64.0.96
mt-3/0/0.32855       4 2             HPG        00:17:54 10.64.0.196
mt-3/0/0.32855       4 2             HPG        00:11:50 10.65.0.104
mt-3/0/0.32855       4 2             HPLGB      00:11:24 10.144.10.2
mt-3/0/0.32855       4 2             HPLGB      00:05:03 10.144.10.4
mt-3/0/0.32855       4 2             HPG        00:01:33 10.144.10.5
mt-3/0/0.32855       4 2             HPLGB      00:01:51 10.144.10.7
mt-3/0/0.32855       4 2             HPLGB      00:01:32 10.144.10.35
mt-3/0/0.32855       4 2             HPLGB      00:02:24 10.144.10.36
mt-3/0/0.32855       4 2             HPLGB      00:03:24 10.144.10.38
mt-3/0/0.32855       4 2             HPLG       00:04:11 10.144.10.81
mt-3/0/0.32855       4 2             HPLG       <strong>00:00:12</strong> 10.144.10.90       #------
mt-3/0/0.32855       4 2             HPLG       <strong>00:00:17</strong> 10.144.10.91       #------
mt-3/0/0.32855       4 2             HPG        00:04:49 172.26.8.48
mt-3/0/0.32855       4 2             HPG        00:02:46 172.26.8.52
mt-3/0/0.32855       4 2             HPG        00:04:54 172.26.8.56
mt-3/0/0.32855       4 2             HPG        00:11:19 172.26.8.88
mt-3/0/0.32855       4 2             HPG        00:20:12 172.26.8.123
mt-3/0/0.32855       4 2             HPG        00:04:57 172.26.8.161
mt-3/0/0.32855       4 2             HPG        00:04:54 172.26.8.233</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_what_caused_the_c_pim_neighborship_flap"> What caused the C-PIM neighborship flap?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" What caused the C-PIM neighborship flap?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
In the mVRF instance PE to PE PIM hellos are sent over the default mdt (using
  group address e.g.<code>239.1.3.1</code>) over mt interfaces (<code>mt-3/0/0.1081431</code>)
</span>
</li>
<li>
<span>
tcpdump on the mt interface at both end shows all PIM Hellos at one PE but
  some of them are missing at the other (problematic) PE.
</span>
</li>
<li>
<span>
match up traffic between sender and receiver confirms no packet drop over default MDT
</span>
<ul class="">
<li>
<span>
following commands displays the traffic forwarded via default MDT forwarding entry:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>show multicast route extensive group 239.1.3.1 source-prefix 10.144.10.91</tt></pre>
</div></div>
</li>
</ul>
</li>
</ul>
<div class="literalblock">
<div class="title">conclusion: packet must have been dropped in egress router itself &#8658; PFE (MS-PIC) issue?</div>
<div class="content incremental">
<pre><tt>                             |       |
  &lt;=======================MVPN traffic=========================&gt;
                     &lt;====P-data-packet====&gt;
+---+---+---------------+    |       |     +---------------+---+---+
|m- |MS-| 10.144.10.xx  +----+ CORE  +---- | 10.64.0.96    |MS-|m- |
|VRF|PIC| other PEs     |    |       |     | desttg1005me2 |PIC|VRF|
+---+---+---------------+    |       |     +---------------+---+---+
                             |       |     (Problematic PE)
                      &lt;--P-PIM neighborship--&gt;
  &lt;-------------------C-PIM neighborship-------------------------&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="title">Some PIM Hellos get dropped at the pfe of egress PE (desttg1005me2 in this case)</div>
<div class="content incremental">
<pre><tt>                             |       |
  &lt;=======================MVPN traffic======================X==&gt;
                     &lt;====P-data-packet====&gt;
+---+---+---------------+    |       |     +---------------+---+---+
|m- |MS-| 10.144.10.xx  +----+ CORE  +---- | 10.64.0.96    |MS-|m- |
|VRF|PIC| other PEs     |    |       |     | desttg1005me2 |PIC|VRF|
+---+---+---------------+    |       |     +---------------+---+---+
                             |       |     (Problematic PE)
                      &lt;--P-PIM neighborship--&gt;
  &lt;-------------------C-PIM neighborship--------------------X----&gt;</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_pfe_ms_pic_forwarding_plane_issue">PFE (MS-PIC) forwarding plane issue?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="PFE (MS-PIC) forwarding plane issue?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_hnq1_high_host_bound_traffic"> HNQ1:high host bound traffic</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" HNQ1:high host bound traffic";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>j-tac-ps1@DESTTG1005ME2-re0&gt; show chassis fpc pic-status
Slot 0   Online       M320 E3-FPC Type 1
  PIC 0  Online       10x CHT1 IQ
  PIC 1  Online       10x CHT1 IQ
  PIC 2  Online       10x CHE1T1 IQE
  PIC 3  Online       4x OC-3 IQE SONET
Slot 1   Online       M320 E3-FPC Type 1
  PIC 0  Online       1x CHOC12 IQE SONET
  PIC 1  Online       1x CHOC12 IQE SONET
  PIC 2  Online       10x CHE1T1 IQE
  PIC 3  Online       1x CHSTM1 IQ SDH, SMIR
Slot 2   Online       M320 E3-FPC Type 2
  PIC 0  Online       8x 1GE(LAN), IQ2E
  PIC 2  Online       8x 1GE(LAN), IQ2
  PIC 3  Online       8x 1GE(LAN), IQ2
Slot 3   Online       M320 E3-FPC Type 3
  PIC 0  Online       MultiServices 500     #&lt;------
  PIC 1  Online       1x 10GE(LAN),XENPAK
Slot 4   Online       M320 E3-FPC Type 3
  PIC 0  Online       MultiServices 500     #&lt;------
  PIC 1  Online       1x 10GE(LAN),XENPAK
Slot 5   Online       M320 E3-FPC Type 2
  PIC 2  Online       8x 1GE(LAN), IQ2
  PIC 3  Online       8x 1GE(LAN), IQ2
Slot 6   Online       M320 E3-FPC Type 2
Slot 7   Online       M320 E3-FPC Type 1
  PIC 0  Online       4x CHDS3/E3 IQE
  PIC 1  Online       4x DS3/E3 IQE
  PIC 2  Online       4x CHDS3 IQ
  PIC 3  Online       2x CHSTM-1 IQE SDH</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="literalblock">
<div class="content">
<pre><tt>j-tac-ps1@DESTTG1005ME2-re0&gt; request pfe execute target fpc3 command "show ichip 0 ptop counters"
SENT: Ukern command: show ichip 0 ptop counters
GOT:
GOT:   Traffic stats:
GOT:              Counter Name            Total           Rate      Peak Rate
GOT:    ---------------------- ---------------- -------------- --------------
GOT:               Read Req RX         20660174           5011           5140
GOT:              Read Resp TX         20660174           5011           5140
GOT:      Read Resp Segment TX         26210412           5332           8154
GOT:              Write Req RX           778150             55            651
GOT:      Write Req Segment RX          1847793            109           5618
GOT:             Write Resp TX           778150             55            651
GOT:     Write Resp Segment TX                0              0              0
GOT:           MTU Redirect TX                0              0              0
GOT:              Age Check TX                0              0              0
GOT:           Flow Control RX          5992275           1590           2434
GOT:           Flow Control TX                2              0              0
GOT:               PIO Read RX        302944473          17257          18204
GOT:               PIO Read TX        302944473          17257          18204
GOT:              PIO Write RX         65356955           2939          18644
GOT:              PIO Write TX         65356955           2939          18644
GOT:      Notification Q[0] TX           138917              8            470
GOT:      Notification Q[1] TX         20503261           5000           5066                       #------
GOT:      Notification Q[2] TX                0              0              0
GOT:      Notification Q[3] TX                0              0              0
GOT:      Notification Q[4] TX                0              0              0
GOT:      Notification Q[5] TX            19354              2              3
GOT:      Notification Q[6] TX                0              0              0
GOT:      Notification Q[7] TX                0              0              0
LOCAL: End of file</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="listingblock">
<div class="content">
<pre><tt>SFPC3(DESTTG1005ME2-re0 vty)# show ichip 0 r counters

  HNP discards:
             Counter Name            Total           Rate      Peak Rate
   ---------------------- ---------------- -------------- --------------
              Q0_DCS_CNTR                0              0              0 &gt;&gt; No packet drop in Q0
              Q1_DCS_CNTR        954935889           3521          64220   &gt;&gt; Packets are getting dropped on the Q1.
              Q2_DCS_CNTR                0              0              0
              Q3_DCS_CNTR                0              0              0
              Q4_DCS_CNTR                0              0              0
              Q5_DCS_CNTR                0              0              0
              Q6_DCS_CNTR                0              0              0
              Q7_DCS_CNTR                0              0              0</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_what_kind_of_traffic"> what kind of traffic?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" what kind of traffic?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>It looks like that this host bound traffic is resolve nexthop traffic, which
is getting rate limited in micro kernel.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>SFPC3(DESTTG1005ME2-re0 vty)# show nhdb management resolve
Next Hop Resolve Statistics:
   70478830 resolve enqueues
   70478830 resolve dequeues
   68342205 resolve duplicates
      48473 resolve queue drops
          0 resolve throttle drops
    2087860 resolve expires  &gt;&gt;&gt;&gt;&gt; resolve requests getting expired.
          8 resolve to hold
      58111 resolve forward

          0 tbucket fails
          0 tree fails
          0 node fails
          0 resolve lookup fails
          0 hold lookup fails
          0 no memory

      16881 resolve heap clamp
   70527303 tokens captured
 1176443367 token capture failed    &gt;&gt;&gt; Rate limited. Counter getting incrementing at a high rate

          0 illegal timer
          0 illegal length
          0 illegal protocol
          0 illegal tree
          0 illegal index
          0 illegal packet
          0 illegal nh

          0 throttle calls
          0 unthrottle calls
          0 throttled interfaces</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="literalblock">
<div class="content">
<pre><tt>j-dev-5@DESTTG1005ME2-re1> show multicast statistics instance 13979:20037
Instance: 13979:20037 Family: INET
Interface: mt-3/0/0.1081348
    Routing protocol:          PIM   Mismatch error:               0
    Mismatch:                    0   Mismatch no route:            0
    Kernel resolve:              0   Routing notify:               0
    Resolve no route:      <strong>98056</strong> Resolve error:                0        #------</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
the <code>show multicast statistics</code> command provide immediate indication of the
  culprit counters, but it works only in per-VRF level.
</span>
</li>
<li>
<span>
is there a global statistics?
</span>
</li>
</ul>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph">
<p>The "<code>HNQ[1]</code> drop" and "resolve packet rate limiting drops" are shown as
<code>hardware input drops</code> and <code>Notification/Control packet drops in ISR</code> in
following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>SFPC3(DESTTG1005ME2-re0 vty)# show pfe statistics traffic
PFE Traffic statistics:
          72512526760 packets input  (216504 packets/sec)
          52432751779 packets output (154559 packets/sec)

PFE Local Traffic statistics:
   93117060 local packets input
   68137344 local packets output
          0 software input control high drops
          0 software input high drops
          0 software input medium drops
          0 software input low drops
          0 software output drops
  956143315 hardware input drops  &gt;&gt;&gt; HNQ[1] drops
 1177112426 Notification/control packet drops in ISR  &gt;&gt;&gt; Resolve rate limited</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_fpc_and_re_cpu"> FPC and RE CPU</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" FPC and RE CPU";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="listingblock">
<div class="title">master RE0 CPU utilization going to 100% sometime</div>
<div class="content">
<pre><tt>j-dev-5@DESTTG1005ME2-re0> show chassis routing-engine 0
May 26 08:04:17
Routing Engine status:
  Slot 0:
    Current state                  Master
    Election priority              Master
    Temperature                 32 degrees C / 89 degrees F
    CPU temperature             35 degrees C / 95 degrees F
    DRAM                      16351 MB (16384 MB installed)
    Memory utilization          17 percent
    CPU utilization:
      User                      52 percent
      Background                 0 percent
      Kernel                    42 percent
      Interrupt                  6 percent
    <strong>Idle                       0 percent</strong>>>> Idle is 0
    Model                          RE-A-1800x2
    Serial ID                      9009166244
    Start time                     2014-05-21 12:51:54 EDT
    Uptime                         4 days, 19 hours, 12 minutes, 23 seconds
    Last reboot reason             Router rebooted after a normal shutdown.
    Load averages:                 1 minute   5 minute  15 minute
                                       1.00       1.75       1.65</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="listingblock">
<div class="title">user process utilization is 89%</div>
<div class="content">
<pre><tt>j-dev-5@DESTTG1005ME2-re0> show chassis routing-engine 0
May 26 02:20:41
Routing Engine status:
  Slot 0:
    Current state                  Master
    Election priority              Master
    Temperature                 32 degrees C / 89 degrees F
    CPU temperature             36 degrees C / 96 degrees F
    DRAM                      16351 MB (16384 MB installed)
    Memory utilization          17 percent
    CPU utilization:
    <strong>User                      89 percent</strong>>>>> 89 % by User processes.
      Background                 0 percent
      Kernel                     7 percent
      Interrupt                  4 percent
      Idle                       0 percent
    Model                          RE-A-1800x2
    Serial ID                      9009166244
    Start time                     2014-05-21 12:51:54 EDT
    Uptime                         4 days, 13 hours, 28 minutes, 48 seconds
    Last reboot reason             Router rebooted after a normal shutdown.
    Load averages:                 1 minute   5 minute  15 minute
                                       1.94       1.54       1.42</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="listingblock">
<div class="title">FPC cpu utilization is consistently very less</div>
<div class="content">
<pre><tt>j-dev-5@DESTTG1005ME2-re0&gt; show chassis fpc
May 26 08:06:00
                     Temp  CPU Utilization (%)   Memory    Utilization (%)
Slot State            (C)  Total  Interrupt      DRAM (MB) Heap     Buffer
  0  Online            39      6          0       1024       20         57
  1  Online            37      2          0       1024       20         58
  2  Online            44      4          0       1024       25         76
  3  Online            44      5          0       1024       29         76
  4  Online            46      5          0       1024       30         74
  5  Online            39      5          0       1024       25         69
  6  Online            39      3          0       1024       25         69
  7  Online            42      3          0       1024       20         57</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_code_hnq1_code_vs_code_nhq0_code"> <code>HNQ1</code> vs. <code>NHQ0</code></h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" <code>HNQ1</code> vs. <code>NHQ0</code>";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="title">conclusion:</div><ul class="">
<li>
<span>
HNQ1 in MS-PIC was congested by high volume of "resolve no route" host bound traffic
</span>
</li>
<li>
<span>
C-PIM hello packets rely on the same HNQ1 , causing C-PIM neighborship flap
</span>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<div class="title">Ichip <code>HNQ</code> priority rules(Ichip only, Trio is completely different):</div><ol class="arabic">
<li>
<span>
During FPC initialization, in PFE,  some of the control flows (nexthops) are
   programmed (to redirect packets),  even before it has
   Forwarding-class-to-queue mapping  information(rule #2) available with it.
   Packets for these flows will take <code>HNQ1</code>, regardless of their TOS value.
</span>
</li>
<li>
<span>
All the control flows (programmed after getting Forwarding-class-to-queue
   mapping information) would select <code>HNQ</code> based on TOS field.
</span>
</li>
</ol>
<div class="title">base on the above rules:</div><ol class="arabic">
<li>
<span>
ideally PIM hello should have been going into <code>HNQ0</code> only
</span>
</li>
<li>
<span>
but if the forwarding-class-to-queue mapping information is not available,
   when nexthop to redirect PIM packets is being programmed (Point#1), they may
   take <code>HNQ1</code>.
</span>
</li>
<li>
<span>
In PFE, there is no protocol based prioritization, hence there is no
   specific list of protocols which would take Q0/Q1 respectively.  But because
   of this ordering, other control protocols could also end up using <code>HNQ1</code>.
</span>
</li>
</ol>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="verseblock">
<div class="title">fix:PR1004413</div>
<pre class="content">This seems to be a tricky day one behavior where we receive control flow
nexthop installation information from kernel before receiving
forwarding-class-to-queue mapping information. So it might not be simple to
fix.  But, if we are able to fix it, it would be for all the control protocols.</pre>
<div class="attribution">
<em>Jun 25 2014 email</em><br />
&#8212; Jitender
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_what_triggered_the_high_volume_of_code_resolve_no_route_code_traffic">what triggered the high volume of <code>resolve no route</code> traffic?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="what triggered the high volume of <code>resolve no route</code> traffic?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_steps_to_find_out_suspicious_c_source_instances_that_contributes_to_the_resolve_no_route_traffic"> steps to find out suspicious c-source/instances (that contributes to the "resolve no route" traffic)</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" steps to find out suspicious c-source/instances (that contributes to the "resolve no route" traffic)";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>here are the steps that can be used to find the C-source address and
routing-instance name of the "resolve no route" traffic <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[4] : these steps were provided by DE(kurt) during the troubleshooting session</div>" ;/*]]>*/</script>
[4]</p>
</div>
<ol class="arabic">
<li>
<span>
Configure the following on desttg1005m2 at the global level (this can be
   done after repro once in a steady bad state):
</span>
<div class="literalblock">
<div class="content">
<pre><tt>set routing-options traceoptions file rpd.log size 1000m
set routing-options traceoptions flag normal</tt></pre>
</div></div>
</li>
<li>
<span>
monitor the following log entries:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>tail -f /var/log/rpd.log | grep "MULTICAST next hop unusable"</tt></pre>
</div></div>
</li>
<li>
<span>
When stabilized in the bad state, watch for messages occuring for the mt-
   interfaces. This gives you the C-Source:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>Jun 19 21:06:34.795017 MULTICAST next hop unusable Group 226.1.1.12 Source 100.36.0.13 interface mt-3/0/0.1081369</tt></pre>
</div></div>
</li>
<li>
<span>
To find the routing table, take the mt- interface name above and do:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>show interfaces mt-4/0/0.1081369 extensive |match "Route table"</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>which gives:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Protocol inet, MTU: Unlimited, Generation: 118743, Route table: 47
Protocol inet6, MTU: Unlimited, Generation: 118744, Route table: 47</tt></pre>
</div></div>
</li>
<li>
<span>
To find the routing-instance name, take the above and do:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>show krt table | match "kernel-id: 47"</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>which gives the routing-instance name:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>13979:20038.inet.0            : GF: 1 krt-index: 48    ID: 0 kernel-id: 47
13979:20038.inet.1            : GF: 1 krt-index: 48    ID: 1 kernel-id: 47
13979:20038.iso.0             : GF: 2 krt-index: 48    ID: 0 kernel-id: 47
13979:20038.inet6.0           : GF: 6 krt-index: 48    ID: 0 kernel-id: 47
13979:20038.inet6.1           : GF: 6 krt-index: 48    ID: 1 kernel-id: 47</tt></pre>
</div></div>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_findings"> findings</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" findings";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>following the steps the following inconsistent routes were found between 2 PEs:</p>
</div>
<div class="literalblock">
<div class="title">On the ingress PE (nypjar2):</div>
<div class="content">
<pre><tt>j-dev-5@NYPJAR2-re0&gt; show route 100.38.0.10 table 13979:20038.inet.0</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>13979:20038.inet.0: 317 destinations, 732 routes (317 active, 0 holddown, 0 hidden)
@ = Routing Use Only, # = Forwarding Use Only
+ = Active Route, - = Last Active, * = Both</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>100.38.0.0/24      @[BGP/170] 23:28:51, localpref 100
                      AS path: 100 I, validation-state: unverified
                    &gt; to 109.9.19.2 via t1-2/2/1:9:19.0
                    [BGP/170] 23:29:11, localpref 100
                      AS path: 100 I, validation-state: unverified
                    &gt; to 109.9.20.2 via t1-2/2/1:9:20.0
                   #[Multipath/255] 23:28:51
                    &gt; to 109.9.19.2 via t1-2/2/1:9:19.0
                      to 109.9.20.2 via t1-2/2/1:9:20.0</tt></pre>
</div></div>
<div class="literalblock">
<div class="title">On the egress PE, DUT (DESTTG1005ME2)</div>
<div class="content">
<pre><tt>j-dev-5@DESTTG1005ME2-re1&gt; ... route 100.38.0.10 table 13979:20038.inet.0</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>13979:20038.inet.0: 215 destinations, 321 routes (215 active, 0 holddown, 0 hidden)
@ = Routing Use Only, # = Forwarding Use Only
+ = Active Route, - = Last Active, * = Both</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>0.0.0.0/0          *[Aggregate/200] 03:30:12
                      Discard</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="title">conclusion: inconsistent route table</div><ul class="">
<li>
<span>
some mVRF instance is getting resolve request for some non-existing SG in the
  VRF PIM
</span>
</li>
<li>
<span>
We have joined a Data MDT for these S,G even though we dont have any VRF PIM
  state. (The data MDT is rooted at PE <code>10.144.10.81</code>)
</span>
</li>
<li>
<span>
there is no usable unicast route for the source that we are trying to resolve
  over the Data-MDT.
</span>
</li>
</ul>
<div class="listingblock">
<div class="content">
<pre><tt>Jun 19 21:06:34.795017 MULTICAST next hop unusable Group 226.1.1.12 Source 100.36.0.13 interface mt-3/0/0.1081369</tt></pre>
</div></div>
<div class="paragraph"><div class="title">The next question:</div>
<p>why the 2 sites of the same VPN didn&#8217;t get the same set of routes?</p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_a_bgp_issue">A BGP issue?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="A BGP issue?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_cisco_rr_cli_shows_it_advertised_the_route"> cisco RR CLI shows it advertised the route</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" cisco RR CLI shows it advertised the route";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>Below is the CLI output that shows those missing routes advertised by cisco RR 10.64.0.27:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>RP/0/0/CPU0:FRNK101PRRB#sh bgp vpnv4 unicast rd 13979:98074300
Thu Jun 26 18:17:53.364 EDT
BGP router identifier 10.64.0.27, local AS number 61000
BGP generic scan interval 300 secs
BGP table state: Active
Table ID: 0x0   RD version: 2903485008
BGP main routing table version 6363057
BGP scan interval 60 secs</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Status codes: s suppressed, d damped, h history, * valid, &gt; best
              i - internal, r RIB-failure, S stale
Origin codes: i - IGP, e - EGP, ? - incomplete
   Network            Next Hop            Metric LocPrf Weight Path
Route Distinguisher: 13979:98074300
*&gt;i6.0.0.0/24         10.144.10.7                   100      0 13979 1111 ?         #&lt;------
*&gt;i6.0.1.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.2.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.3.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.4.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.5.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.6.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.7.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.8.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.9.0/24         10.144.10.7                   100      0 13979 1111 ?
*&gt;i6.0.10.0/24        10.144.10.7                   100      0 13979 1111 ?
..</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="literalblock">
<div class="content">
<pre><tt>RP/0/0/CPU0:FRNK101PRRB#sh bgp vpnv4 unicast rd <strong>61000:4922002</strong> 6.0.0.0/24
Thu Jun 26 18:42:10.072 EDT
BGP routing table entry for 6.0.0.0/24, Route Distinguisher: 61000:4922002
Versions:
  Process           bRIB/RIB  SendTblVer
  Speaker            3810851     3810851
Last Modified: Jun 23 11:15:06.833 for 3d07h
Paths: (1 available, best 1)
  Advertised to update-groups (with more than one peer):
    0.1 0.5
  Advertised to peers (in unique update groups):
    10.64.0.196     10.64.0.101     10.64.0.64      10.54.57.2
    10.64.10.140    10.64.50.94
  Path #1: Received by speaker 0
  Advertised to update-groups (with more than one peer):
    0.1 0.5
  Advertised to peers (in unique update groups):
    10.64.0.196     10.64.0.101     10.64.0.64      10.54.57.2
    10.64.10.140    <strong>10.64.50.94</strong>
  393222 54
    10.64.0.92 (metric 652) from 10.64.0.44 (10.64.0.92)
      Received Label 10512
      Origin incomplete, metric 0, localpref 100, valid, internal, best, group-best, import-candidate, not-in-vrf
      Received Path ID 0, Local Path ID 1, version 3810851
      Extended community: <strong>RT:13979:9792002</strong>
      Originator: 10.64.0.92, Cluster list: 13.1.1.1
      Connector: type: 1, Value:61000:4922002:10.64.0.92
RP/0/0/CPU0:FRNK101PRRB</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_juniper_cli_shows_the_route_was_not_received_from_the_specific_rr_cisco"> Juniper CLI shows the route was not received from the specific RR(cisco)</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" Juniper CLI shows the route was not received from the specific RR(cisco)";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="literalblock">
<div class="title">routing table:</div>
<div class="content">
<pre><tt>sarahyu@DESTTG1005ME2-re1> show route table enaprov2 | except ge | except 10.64.0.181 | except 10.64.0.166
Jun 26 17:47:48
enaprov2.inet.0: 86 destinations, 249 routes (86 active, 0 holddown, 0 hidden)
@ = Routing Use Only, # = Forwarding Use Only
+ = Active Route, - = Last Active, * = Both
6.0.0.0/24         *[BGP/170] 00:16:59, MED 0, localpref 100, from <strong>10.64.0.29</strong>
                      AS path: 393222 54 ?, validation-state: unverified
                    [BGP/170] 00:17:30, MED 0, localpref 100, from 10.64.0.66
                      AS path: 393222 54 ?, validation-state: unverified
                    [BGP/170] 00:18:18, MED 0, localpref 100, from 10.64.0.67
                      AS path: 393222 54 ?, validation-state: unverified</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">the prefix was learned from the other cisco RR <code>10.64.0.29</code>, but <strong>not</strong> from the RR <code>10.64.0.27</code>.</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="literalblock">
<div class="title">BGP logs:</div>
<div class="content">
<pre><tt>j-tac-ps1@DESTTG1005ME2-re1&gt; show configuration protocols bgp | display set | match traceoption
set protocols bgp group PE2intraASV4V6RR traceoptions file bgp-trace-ciscoRR
set protocols bgp group PE2intraASV4V6RR traceoptions file size 1g
set protocols bgp group PE2intraASV4V6RR traceoptions flag update detail
set protocols bgp group PE2intraASV4V6RR traceoptions flag open detail
set protocols bgp group PE2intraASV4V6RR traceoptions flag refresh detail</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ grep -inE "10\.64\.0\.29+.* -> |10\.64\.0\.27\+.* -> |4922002:6\.0\.0\.0" bgp-trace-ciscoRR   | grep -B1 ":6\.0\.0\.0"
216358:Jun 26 17:30:50.397855 BGP RECV <strong>10.64.0.29</strong>+22546 -> 10.64.50.94+179
216365:Jun 26 17:30:50.397923 BGP RECV  61000:4922002:6.0.1.0/24 (label 10511) , 61000:4922002:6.0.0.0/24 (label 10512)
216383:Jun 26 17:30:50.398856 bgp_rcv_nlri: 61000:4922002:6.0.0.0/88</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
this was from June 26 troubleshooting session, raw data location
<code>pings@svl-jtac-tool02 ~/CSdata/995293/0626/</code>
</span>
</li>
<li>
<span>
detail steps to search a specifix prefix in BGP trace logs from Junos router
  "on the fly" , was provided in <a href="#appendix">[appendix]</a>
</span>
</li>
</ul>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
BGP RECV tracelogs is emitted by Junos-BGP before even the routes
  internal-datastructure-representation is created or any processing like
  import-policy/rejection is applied.
</span>
</li>
<li>
<span>
basically it is what Junos-BGP received from the wire, from the
  Junos-TCP-Kernel to be more precise. That is why, we can trust that BGP
  tracelogs are quite "reliable"
</span>
</li>
</ul>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_some_suspicions"> some suspicions</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" some suspicions";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="title">suspicions can be:</div><ol class="arabic">
<li>
<span>
RR was not actually sending it, and the reason can be :
</span>
<ul class="">
<li>
<span>
either RR bug
</span>
</li>
<li>
<span>
or non-RR issue, e.g.:
</span>
<ul class="">
<li>
<span>
PE RT filter message was not delivered to the RR
</span>
</li>
<li>
<span>
other non-RR problem
</span>
</li>
</ul>
</li>
</ul>
</li>
<li>
<span>
the route was sent by RR , but got lost "somewhere in the middle" before reaching PE?
</span>
</li>
<li>
<span>
RR sent the route, PE got it, but PE then dropped it for some reason. e.g.:
</span>
<ul class="">
<li>
<span>
local VRF importing the RT was not configured when the VPN-route was
    received <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[5] : meaning configuration error - not likely in this case</div>" ;/*]]>*/</script>
[5].
</span>
</li>
<li>
<span>
misterious/unknown problem
</span>
</li>
</ul>
</li>
</ol>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
Junos does send a Route-Refresh/new-RTC-update whenever a new-VRF is
  configured;
</span>
</li>
<li>
<span>
if that didnt happen then it is a bug.
</span>
</li>
</ul>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_packet_capture"> packet capture</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" packet capture";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
to test it out customer performed wireshark/tcpdump capture in the switch
</span>
</li>
<li>
<span>
all BGP traffics between cisco RR and Juniper PE were captured
</span>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content"><a href="http://www-in.juniper.net/~pings/casedata/2014-0521-0835/07-01-2014-21903-2.pcapng">this</a>
is the BGP session captured after GRES, extracted from the (much bigger!) raw
packet capture which contains a lot of other noise</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">the data was captured in the <code>pcapng</code> file format. current version of
<code>tcpdump</code> tool available in Juniper shell server may not be able to fully
support the format. <code>wireshark</code> or <code>tshark</code> fully support this new format.</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_searching_a_capture_file"> searching a capture file</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" searching a capture file";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="title">what&#8217;s the best way to search a <strong>huge</strong> packet capture file?</div><ul class="">
<li>
<span>
tcpdump is classic/legentary tool, but no much support for high level
  protocol content searching
</span>
</li>
<li>
<span>
wireshark is great and easier to search, but requires X-window and a more powerful PC
</span>
</li>
<li>
<span>
<a href="#tshark">[tshark]</a> is so far the best combination:
</span>
<ul class="">
<li>
<span>
as powerful as wireshark, especially in that "display filter expression".
</span>
</li>
<li>
<span>
terminal based, less memory usage, good for CLI pipe streams
</span>
<div class="literalblock">
<div class="content">
<pre><tt>tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix==55.21.1.0" -t a</tt></pre>
</div></div>
</li>
</ul>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">with a relatively large pcap file, wireshark will quickly consumes a lot
of memories and make the PC extremely slow or very often even crashing - try
loading a 1G pcap file in your windows PC, and do some search with display
filters.</td>
</tr></table>
</div>
<div class="title">pcap file shows:</div><ul class="">
<li>
<span>
the captured pcap shows that the missing routes were never sent by Cisco! <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[6] : more details later</div>" ;/*]]>*/</script>
[6]
</span>
</li>
<li>
<span>
cisco insisted this might be caused by Juniper&#8217;s wrong behavior:
</span>
<ul class="">
<li>
<span>
e.g. sending the <code>tcp zero size window</code> packets
</span>
</li>
<li>
<span>
other Juniper issues
</span>
</li>
</ul>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_rt_filter_rtc_communication_problem"> RT filter(RTC) communication problem?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" RT filter(RTC) communication problem?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="title">suspision</div><ul class="">
<li>
<span>
Juniper PE didn&#8217;t send the RT filter address family information,
</span>
</li>
<li>
<span>
without RT filter request, RR is not supposed to send the prefixes with that specific RTs.
</span>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
<a href="http://www.cisco.com/c/en/us/support/docs/multiprotocol-label-switching-mpls/mpls/116062-technologies-technote-restraint-00.html">here</a> is a document illustrating <a href="http://www.juniper.net/techpubs/en_US/junos14.1/topics/usage-guidelines/vpns-configuring-bgp-route-target-filtering-in-vpns.html">BGP RTC feature</a>
</span>
</li>
</ul>
</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">RTC negotiatin</div>
<p>The open message clearly indicated the RTC was negotiated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>jtac@scooby2:/mnt/NAS/media/jtac/jtac/ping/995293/0701$ zgrep -niHE "open|route target filter" 07-01-2014-21903-wshark.txt.gz
07-01-2014-21903-wshark.txt.gz:275:      4 16:48:02.760110000 10.64.0.27            10.64.50.94           BGP      139    OPEN Message
07-01-2014-21903-wshark.txt.gz:353:Border Gateway Protocol - OPEN Message
07-01-2014-21903-wshark.txt.gz:356:    Type: OPEN Message (1)
07-01-2014-21903-wshark.txt.gz:407:              <strong>SAFI: Route Target Filter (132)</strong>
07-01-2014-21903-wshark.txt.gz:429:      5 16:48:02.781445000 10.64.50.94           10.64.0.27            BGP      137    OPEN Message
07-01-2014-21903-wshark.txt.gz:509:Border Gateway Protocol - OPEN Message
07-01-2014-21903-wshark.txt.gz:512:    Type: OPEN Message (1)
07-01-2014-21903-wshark.txt.gz:554:              <strong>SAFI: Route Target Filter (132)</strong></tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph"><div class="title">juniper RT NLRI advertisement</div>
<p>And the RTC was already advertised by Juniper in the 1st update , way before the zero win crab (16:50:28)s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>07-01-2014-21903-wshark.txt.gz:4128:     22 16:48:22.196800000 10.64.50.94           10.64.0.27            BGP      1391   UPDATE Message
07-01-2014-21903-wshark.txt.gz:4206:Border Gateway Protocol - UPDATE Message
07-01-2014-21903-wshark.txt.gz:4209:    Type: UPDATE Message (2)
07-01-2014-21903-wshark.txt.gz:4322:                MP Reach NLRI 61000:13979:20011/96
07-01-2014-21903-wshark.txt.gz:4325:                  <strong>MP Reach NLRI Community prefix: 13979:20011</strong></tt></pre>
</div></div>
<div class="listingblock">
<div class="title">cisco UPDATE prefixes with the requested RT <script type="text/javascript">/*<![CDATA[*/slidefootnotes += "<div class='footnote'>[7] : this indicates the RT filter info was successfully received by CISCO</div>" ;/*]]>*/</script>
[7]</div>
<div class="content">
<pre><tt>1044    16:48:40.149882000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
    Network layer reachability information (32 bytes)
        Label Stack=25500 (bottom) RD=13979:90173251, IPv4=11.1.11.0/30
            MP Reach NLRI Prefix length: 118
            MP Reach NLRI Label Stack: 25500 (bottom)
            MP Reach NLRI Route Distinguisher: 13979:90173251
            MP Reach NLRI IPv4 prefix: 11.1.11.0 (11.1.11.0)
        Label Stack=25501 (bottom) RD=13979:90173251, IPv4=14.1.1.2/32
            MP Reach NLRI Prefix length: 120
            MP Reach NLRI Label Stack: 25501 (bottom)
            MP Reach NLRI Route Distinguisher: 13979:90173251
            MP Reach NLRI IPv4 prefix: 14.1.1.2 (14.1.1.2)
    .......
   two-octet AS specific Route Target: <strong>13979:20011</strong>
......
6032    16:52:52.982330000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph"><div class="title">conclusion:</div>
<p>the captures shows the RTC communication looks normal:</p>
</div>
<ul class="">
<li>
<span>
Juniper sent RT filter NLRI
</span>
</li>
<li>
<span>
Cisco must have been received them
</span>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="_a_tcp_problem">A TCP problem?</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="A TCP problem?";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
the wireshark capture shows a lot of <code>TCP ZeroWindow</code> related alert.
</span>
<ul class="">
<li>
<span>
<code>TCP ZeroWindow</code>
</span>
</li>
<li>
<span>
<code>TCP ZeroWindowProbe</code>
</span>
</li>
<li>
<span>
<code>TCP ZeroWindowProbeAck</code>
</span>
</li>
</ul>
</li>
<li>
<span>
all <code>TCP ZeroWindow</code> packets were sent from Juniper PE, none of them were from Cisco RR.
</span>
<div class="literalblock">
<div class="content">
<pre><tt>84 16:48:24.172268000  10.64.50.94 -> 10.64.0.27   BGP 1151 <strong>[TCP ZeroWindow]</strong> UPDATE Message
86 16:48:24.368696000  10.64.50.94 -> 10.64.0.27   BGP 1151 <strong>[TCP ZeroWindow]</strong> UPDATE Message
87 16:48:24.474446000   10.64.0.27 -> 10.64.50.94  TCP 60 <strong>[TCP ZeroWindowProbe]</strong> [TCP segment of a reassembled PDU]
88 16:48:24.502182000  10.64.50.94 -> 10.64.0.27   TCP 60 <strong>[TCP ZeroWindowProbeAck]</strong> [TCP ZeroWindow] bgp > 21903 [ACK] Seq=23706 Ack=21407 Win=0 Len=0
89 16:48:24.502375000  10.64.50.94 -> 10.64.0.27   BGP 1151 <strong>[TCP ZeroWindow]</strong> UPDATE Message
91 16:48:24.611083000  10.64.50.94 -> 10.64.0.27   BGP 1151 <strong>[TCP ZeroWindow]</strong> UPDATE Message
92 16:48:24.771277000  10.64.50.94 -> 10.64.0.27   BGP 1514 <strong>[TCP ZeroWindow]</strong> UPDATE Message
94 16:48:24.793348000  10.64.50.94 -> 10.64.0.27   BGP 788 <strong>[TCP ZeroWindow]</strong> UPDATE Message
95 16:48:24.950167000  10.64.50.94 -> 10.64.0.27   BGP 1514 <strong>[TCP ZeroWindow]</strong> UPDATE Message, UPDATE Message
96 16:48:24.950258000  10.64.50.94 -> 10.64.0.27   TCP 1514 <strong>[TCP ZeroWindow]</strong> [TCP segment of a reassembled PDU]
98 16:48:24.972799000  10.64.50.94 -> 10.64.0.27   BGP 577 <strong>[TCP ZeroWindow]</strong> UPDATE Message
99 16:48:25.056846000  10.64.50.94 -> 10.64.0.27   TCP 1514 <strong>[TCP ZeroWindow]</strong> [TCP segment of a reassembled PDU]
01 16:48:25.076554000   10.64.0.27 -> 10.64.50.94  TCP 60 <strong>[TCP ZeroWindowProbe]</strong> [TCP segment of a reassembled PDU]
02 16:48:25.078965000  10.64.50.94 -> 10.64.0.27   BGP 697 <strong>[TCP ZeroWindow]</strong> UPDATE Message
03 16:48:25.101271000  10.64.50.94 -> 10.64.0.27   TCP 60 <strong>[TCP ZeroWindowProbeAck]</strong> [TCP ZeroWindow] bgp > 21903 [ACK] Seq=33640 Ack=21407 Win=0 Len=0
04 16:48:25.152690000  10.64.50.94 -> 10.64.0.27   TCP 1514 <strong>[TCP ZeroWindow]</strong> [TCP segment of a reassembled PDU]
06 16:48:25.175445000  10.64.50.94 -> 10.64.0.27   BGP 697 <strong>[TCP ZeroWindow]</strong> UPDATE Message</tt></pre>
</div></div>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">see
<a href="http://www-in.juniper.net/~pings/casedata/2014-0521-0835/07-01-2014-21903-all-about-win0.txt">this</a>
file for all occurrence of the zero size window packet in this capture.</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_some_not_so_well_known_tcp_terms"> some "not-so-well-known" TCP terms</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" some "not-so-well-known" TCP terms";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="dlist"><dl class="">
<dt class="hdlist1">
tcp packet with zero size window 
</dt>
<dd>
</dd>
</dl></div>
<div class="verseblock">
<pre class="content">Note that when the receive window is zero no segments should be acceptable
except ACK segments.  Thus, it is be possible for a TCP to maintain a zero
receive window while transmitting data and receiving ACKs.
&#8230;
When the receiving TCP has a zero window and a segment arrives it must still
send an acknowledgment showing its next expected sequence number and current
window (zero).</pre>
<div class="attribution">
<em>RFC793</em>
</div></div>
<div class="dlist"><dl class="">
<dt class="hdlist1">
tcp zero window probe (ZWP) packet
</dt>
<dd>
</dd>
</dl></div>
<div class="verseblock">
<pre class="content">Probing of zero (offered) windows MUST be supported.

A TCP MAY keep its offered receive window closed indefinitely. As long as the
receiving TCP continues to send acknowledgments in response to the probe
segments, the sending TCP MUST allow the connection to stay open.

DISCUSSION: It is extremely important to remember that ACK (acknowledgment)
segments that contain no data are not reliably transmitted by TCP. If zero
window probing is not supported, a connection may hang forever when an ACK
segment that re-opens the window is lost.

The delay in opening a zero window generally occurs when the receiving
application stops taking data from its TCP. For example, consider a printer
daemon application, stopped because the printer ran out of paper.

The transmitting host SHOULD send the first zero-window probe when a zero
window has existed for the retransmission timeout period (see Section
4.2.2.15), and SHOULD increase exponentially the interval between successive
probes.</pre>
<div class="attribution">
<em>RFC1122</em>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">RFC793 and RFC1122 includes most of the info involved here, some brief
summary of these terms can be found in the
<a href="http://wiki.wireshark.org/TCP_Analyze_Sequence_Numbers">wireshark website</a>.</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
TCP probe acknowledge
</dt>
<dd>
<p>
the receiver ack the ZWP(zero window probes) with one of the below 2 actions:
</p>
<ul class="">
<li>
<span>
another zero window ACK packet when we dont have space (and not updating the ACK#)"
</span>
<ul class="">
<li>
<span>
the sender will have to re-transmit the already-sent 1 Byte data
</span>
</li>
</ul>
</li>
<li>
<span>
a TCP window update ACK packet with the window size updated to the actual space when we have room (with updated ACK# by one byte)".
</span>
<ul class="">
<li>
<span>
the sender will start to bump the data with the notified buffer size, starting from the next byte following the 1 Byte data which was sent in the ACKed probe packet
</span>
</li>
</ul>
</li>
</ul>
</dd>
<dt class="hdlist1">
TCP windows update
</dt>
<dd>
<p>
a TCP ACK packet indicating an updated (non-zero) window size, when the receiver becomes capable of receive more data
</p>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_a_typical_interaction"> a typical interaction</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" a typical interaction";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>//juniper sent zero-size window packet(an UPDATE msg):
84      16:48:24.172268000      10.64.50.94     10.64.0.27      BGP     1151    [TCP ZeroWindow] UPDATE Message
Transmission Control Protocol, Src Port: bgp (179), Dst Port: 21903 (21903), Seq: 21512, Ack: 21407, Len: 1097

//cisco acknowledged the packet
85      16:48:24.172559000      10.64.0.27      10.64.50.94     TCP     60      21903 &gt; bgp [ACK] Seq=21407 Ack=22609 Win=32768 Len=0

//juniper sent zero-size window packet again (another UPDATE msg):
86           16:48:24.368696000         10.64.50.94         10.64.0.27            BGP       1151       [TCP ZeroWindow] UPDATE Message
Transmission Control Protocol, Src Port: bgp (179), Dst Port: 21903 (21903), Seq: 22609, Ack: 21407, Len: 1097

//cisco sent zerowin probe, after about 300ms
//  1 byte data, with Ack:23706=22609(frame86)+1097(frame86)
87           16:48:24.474446000         10.64.0.27            10.64.50.94         TCP        60           [TCP ZeroWindowProbe] [TCP segment of a reassembled PDU]
Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: 21407, Ack: 23706, Len: 1

//juniper Ack.ed the probe, with another win0+(original)
//Ack#,indicating that it is still not able to receive more data at the moment
//(this is different with the normal Ack# which should have been 21407+1=21408)
88           16:48:24.502182000         10.64.50.94         10.64.0.27            TCP        60           [TCP ZeroWindowProbeAck] [TCP ZeroWindow] bgp &gt; 21903 [ACK] Seq=23706 Ack=21407 Win=0 Len=0
Transmission Control Protocol, Src Port: bgp (179), Dst Port: 21903 (21903), Seq: 23706, Ack: 21407, Len: 0

//after 3.3s Juniper got some CPU cycle, so enlarge win to 4k, 7k, and 11k, and cisco started to send update message
150         16:48:27.831707000         10.64.50.94         10.64.0.27            TCP        60           [TCP Window Update] bgp &gt; 21903 [ACK] Seq=62316 Ack=21407 Win=4096 Len=0
151         16:48:27.831733000         10.64.50.94         10.64.0.27            TCP        60           [TCP Window Update] bgp &gt; 21903 [ACK] Seq=62316 Ack=21407 Win=7889 Len=0
152         16:48:27.831746000         10.64.50.94         10.64.0.27            TCP        60           [TCP Window Update] bgp &gt; 21903 [ACK] Seq=62316 Ack=21407 Win=11421 Len=0

153         16:48:27.832179000         10.64.0.27            10.64.50.94         BGP       1514       UPDATE Message</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="title">following behavior behavior were observed in the pcap</div><ul class="">
<li>
<span>
in this BGP session a lot of TCP zero window size packets (<code>win0</code> packet)
  were generated from Juniper PE, indicating system temporarily busy (hence
  requesting peer to slow down the data);
</span>
</li>
<li>
<span>
Cisco sent <code>zero window probe</code> (called "ZWP" per RFC1122) periodically ,
  containing just 1Byte data, to detect if Juniper can update a non-zero window
  to receive more data;
</span>
</li>
<li>
<span>
Juniper then responded with:
</span>
<ul class="">
<li>
<span>
either the same <code>win0</code> packet (dropping the 1 Byte data using the original
    ACK#),
</span>
</li>
<li>
<span>
or an window update packet including an updated window size to indicate
    current receiving buffer size.
</span>
</li>
</ul>
</li>
<li>
<span>
the zero size window and the acknowledge to the probe packets looks normal
</span>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_juniper_irrelevant_bug_window_update_with_64k_window_size"> Juniper (irrelevant) bug: window update with 64K window size</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" Juniper (irrelevant) bug: window update with 64K window size";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph"><div class="title">window update with size 64k in response to ZWP</div>
<p>it was found that some of the window update packets from Juniper are with a huge number (64K) than expected (&#8656;16k)</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>574     16:48:32.509961000      10.64.0.27      10.64.50.94     TCP     60      [TCP ZeroWindowProbe] [TCP segment of a reassembled PDU]
    Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: 255654, Ack: 161081, Len: 1
575     16:48:32.516471000      10.64.50.94     10.64.0.27      TCP     60      [TCP ACKed unseen segment] bgp &gt; 21903 [ACK] Seq=161081 Ack=255655 Win=65535 Len=0
576     16:48:32.517036000      10.64.0.27      10.64.50.94     TCP     1514    [TCP Previous segment not captured] [TCP segment of a reassembled PDU]
    Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: 255655, Ack: 161081, Len: 1460</tt></pre>
</div></div>
<div class="paragraph">
<p>and it appeared multiple time in the BGP session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>575  16:48:32.516471000  10.64.50.94 -&gt; 10.64.0.27   TCP 60 [TCP ACKed lost segment] bgp &gt; 21903 [ACK] Seq=161081 Ack=255655 Win=65535 Len=0
1363 16:48:45.558688000  10.64.50.94 -&gt; 10.64.0.27   TCP 60 [TCP ACKed lost segment] bgp &gt; 21903 [ACK] Seq=167564 Ack=833714 Win=65535 Len=0
2574 16:49:21.070674000  10.64.50.94 -&gt; 10.64.0.27   TCP 60 [TCP ACKed lost segment] bgp &gt; 21903 [ACK] Seq=168476 Ack=1686787 Win=65535 Len=0
6037 16:52:53.385547000  10.64.50.94 -&gt; 10.64.0.27   TCP 60 [TCP ACKed lost segment] bgp &gt; 21903 [ACK] Seq=169178 Ack=3908026 Win=65535 Len=0</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<ul class="">
<li>
<span>
starting from 65535, whenever PE received a new UPDATE message coming from
  the cisco PE, PE announced a smaller window size (<code>previous win-size -
  received data size</code>) in the ACK packet
</span>
</li>
<li>
<span>
The window size lower down all the way to 0.
</span>
</li>
</ul>
<div class="listingblock">
<div class="content">
<pre><tt>frame.number    frame.time      frame.time_delta  frame.pkt_len frame.protocols ip.src          tcp.srcport ip.dst tcp.dstport tcp.seq  tcp.ack tcp.window_size
575     Jul  1, 2014 16:48:32.516471000 0.006510000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  255655  65535
579     Jul  1, 2014 16:48:32.615031000 0.097773000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  258575  62615
582     Jul  1, 2014 16:48:32.616111000 0.000363000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  261495  59695
585     Jul  1, 2014 16:48:32.617126000 0.000408000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  264415  56775
588     Jul  1, 2014 16:48:32.618134000 0.000358000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  267335  53855
592     Jul  1, 2014 16:48:32.619219000 0.000257000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  270255  50935
593     Jul  1, 2014 16:48:32.619488000 0.000269000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  273175  48015
598     Jul  1, 2014 16:48:32.620367000 0.000308000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  276095  45095
599     Jul  1, 2014 16:48:32.620569000 0.000202000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  279015  42175
605     Jul  1, 2014 16:48:32.621586000 0.000296000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  281935  39255
606     Jul  1, 2014 16:48:32.621683000 0.000097000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  284855  36335
611     Jul  1, 2014 16:48:32.742057000 0.119645000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  287775  33415
612     Jul  1, 2014 16:48:32.742083000 0.000026000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  290695  30495
617     Jul  1, 2014 16:48:32.743070000 0.000087000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  293615  27575
620     Jul  1, 2014 16:48:32.743677000 0.000014000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  296535  24655
624     Jul  1, 2014 16:48:32.744090000 0.000013000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  299455  21735
626     Jul  1, 2014 16:48:32.744425000 0.000014000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  302375  18815
630     Jul  1, 2014 16:48:32.744801000 0.000014000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  305295  15895
633     Jul  1, 2014 16:48:32.781499000 0.036408000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  308215  12975
634     Jul  1, 2014 16:48:32.781519000 0.000020000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  311135  10055
635     Jul  1, 2014 16:48:32.781534000 0.000015000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  314055  7135
640     Jul  1, 2014 16:48:32.782582000 0.000294000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  316975  4215
641     Jul  1, 2014 16:48:32.782819000 0.000237000             eth:ip:tcp      10.64.50.94     179     10.64.0.27      21903   161081  319895  1295
643     Jul  1, 2014 16:48:32.877003000 0.093711000             eth:ip:tcp:bgp  10.64.50.94     179     10.64.0.27      21903   161081  321190  0</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
this is a valid Juniper bug
</span>
</li>
<li>
<span>
but it&#8217;s not the cause of the issue (actually non-harmful at all in this
  case)
.DE comments
</span>
</li>
</ul>
<div class="verseblock">
<pre class="content">When we have received a zero window probe from the TCP peer (in this case Cisco
RR), due to some bad conversion (typecasting negative number to long datatype
in 64-bit kernel)  we are updating the rcv_wnd to 64K, which is incorrect.

Due to this pattern Cisco RR sending us the burst of BGP update packets, and in
Junos kernel there is a logic to append received data to the socket based on
the window size we are advertising (64k and going down gradually again to zero
window).

We again verified this in local setup (using server  client model program) and
we have not any seen  impact due to the 64k recv window bug. We are working on
the fix to address this issue.

Fix for 64k recv window bug will not solves the problem customer facing. Because :
1. Here (as per previous mails from Ping) route data which is missing in
   Juniper PE BGP is not at all shown in the wireshark.
2. Though we have incorrectly advertised 64K window, (as per our experiments
   and analysis ) Junos kernel has the capability  to append the received to
   the BGP socket.</pre>
<div class="attribution">
<em>Tuesday July 08 2014 email</em><br />
&#8212; Srushti Gowdru Shivakumara
</div></div>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_cisco_issue_duplicate_bgp_update"> cisco issue:duplicate BGP update</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" cisco issue:duplicate BGP update";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>It was found that cisco sent
<a href="http://www-in.juniper.net/~pings/casedata/2014-0521-0835/dup-update.html">duplicate
BGP update</a> , to the same set of RTC prefixes - while missing other prefixes with
the same RT community. Looks definitely <strong>not normal</strong>.</p>
</div>
<div class="listingblock">
<div class="title">comparision result of the 2 sets of BGP updates:</div>
<div class="content">
<pre><tt>    2 Frame6032: 1514 bytes on wire (12112 bits), 1514 bytes captured (12112 bit    2 Frame1044: 1514 bytes on wire (12112 bits), 1514 bytes captured (12112 bit
+   3 +--  2 lines: Interface id: 0                                             +   3 +--  2 lines: Interface id: 0
    5     Arrival Time: Jul  1, 2014 16:52:52.982330000                   5     Arrival Time: Jul  1, 2014 16:48:40.149882000 
-   6     [Time shift for this packet: 0.000000000 seconds]                     -   6     [Time shift for this packet: 0.000000000 seconds]
    7     Epoch Time: 1404247972.982330000 seconds                                  7     Epoch Time: 1404247720.149882000 seconds
    8     [Time delta from previous captured frame: 0.000087000 seconds]            8     [Time delta from previous captured frame: 0.000099000 seconds]
    9     [Time delta from previous displayed frame: 0.000087000 seconds]           9     [Time delta from previous displayed frame: 0.000099000 seconds]
   10     [Time since reference or first frame: 290.254565000 seconds]             10     [Time since reference or first frame: 37.422117000 seconds]
   11     Frame Number: 6032                                                       11     Frame Number: 1044
+  12 +-- 22 lines: Frame Length: 1514 bytes (12112 bits)                       +  12 +-- 22 lines: Frame Length: 1514 bytes (12112 bits)
   34     Identification: 0x0b67 (2919)                                            34     Identification: 0x009e (158)
+  35 +--  7 lines: Flags: 0x02 (Don't Fragment)                                +  35 +--  7 lines: Flags: 0x02 (Don't Fragment)
   42     Header checksum: 0x22fc [validation disabled]                            42     Header checksum: 0x2dc5 [validation disabled]
+  43 +--  6 lines: [Good: False]                                               +  43 +--  6 lines: [Good: False]
   49 Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179   49 Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179&gt;
+  50 +--  3 lines: Source port: 21903 (21903)                                  +  50 +--  3 lines: Source port: 21903 (21903)
   53     Sequence number: 3905527    (relative sequence number)                   53     Sequence number: 602935    (relative sequence number)
   54     [Next sequence number: 3906987    (relative sequence number)]            54     [Next sequence number: 604395    (relative sequence number)]
   55     Acknowledgment number: 169178    (relative ack number)                   55     Acknowledgment number: 166376    (relative ack number)
+  56 +-- 12 lines: Header length: 20 bytes                                     +  56 +-- 12 lines: Header length: 20 bytes
   68     Window size value: 32467                                                 68     Window size value: 32200
   69     [Calculated window size: 32467]                                          69     [Calculated window size: 32200]
-  70     [Window size scaling factor: 1]                                       -  70     [Window size scaling factor: 1]
   71     Checksum: 0x4ab8 [validation disabled]                                   71     Checksum: 0xbba7 [validation disabled]
+  72 +--  6 lines: [Good Checksum: False]                                      +  72 +--  6 lines: [Good Checksum: False]
   78 [2 Reassembled TCP Segments (201 bytes): #6031(22), #6032(179)]              78 [2 Reassembled TCP Segments (201 bytes): #1043(22), #1044(179)]
   79     [Frame: 6031, payload: 0-21 (22 bytes)]                                  79     [Frame: 1043, payload: 0-21 (22 bytes)]
   80     [Frame: 6032, payload: 22-200 (179 bytes)]                               80     [Frame: 1044, payload: 22-200 (179 bytes)]
+  81 +--398 lines: [Segment count: 2]                                          +  81 +--398 lines: [Segment count: 2]
  479    6033 16:52:52.982997000 10.64.50.94           10.64.0.27            TCP  479    1045 16:48:40.150351000 10.64.50.94           10.64.0.27                 TCP    g&gt;</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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" />
</td>
<td class="content">this was generated by the <code>vimdiff</code> tool - all same lines were folded.</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_conclusions_juniper_is_behaving_correctly"> conclusions: Juniper is behaving correctly</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" conclusions: Juniper is behaving correctly";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>from the wireshark capture and the above timeline , the following conclusions
can be observed:</p>
</div>
<ol class="arabic">
<li>
<span>
the missing routes were not advertised from cisco, so Juniper didn&#8217;t get the routes
</span>
</li>
<li>
<span>
RT filter communication was successful - Juniper delivered the interested RT
   filter community info
</span>
</li>
<li>
<span>
the <code>win0</code> tcp packets are normal behavior
</span>
<div class="openblock">
<div class="content">
<ul class="">
<li>
<span>
It&#8217;s very expected that advertising the zero window when application (BGP in
  this case) is not consuming data quickly, specificially in this case RPD
  could be busy (route re-learning, sync, etc) for a while after RE switchover.
</span>
</li>
<li>
<span>
It clearly should not be the reason for Cisco RR to not send
  the ROUTES for rest of the time (cisco bug).
</span>
<ol class="loweralpha">
<li>
<span>
the <code>win0</code> packets ON and OFF behavior last just no more than 5 Minutes.
</span>
</li>
<li>
<span>
during the 5 minutes Juniper PE have advertised the bigger window size,
       Cisco RR acknowledged this and sent more BGP updates.
</span>
</li>
<li>
<span>
tcp sliding windows works normal and data was sent and received without
       problem. keepalive packets were seen and HOLD TIME never expired
</span>
</li>
</ol>
</li>
</ul>
</div></div>
</li>
<li>
<span>
CISCO sent some duplicate BGP update messages (so some of the previously
   advertised prefixes was repeated, while other prefix that should
   have been advertised was missing)
</span>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_the_final_story_conclusion"> the final story/conclusion</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" the final story/conclusion";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ol class="arabic incremental">
<li>
<span>
Juniper PE RE was busy right after RE switchover
</span>
</li>
<li>
<span>
PE sent zero size window packet to remote cisco RR indicating it is not ready to receive more data
</span>
</li>
<li>
<span>
(most probably triggered by the zero window packets,) cisco didn&#8217;t send complete prefixes to
  PE, while at the same time sent duplicate UPDATE to other prefixes.
</span>
<ul class=" incremental">
<li>
<span>
Cisco admitted it&#8217;s a bug in the RR and will be fixed in the next release
</span>
</li>
</ul>
</li>
<li>
<span>
this makes PE under GRES test missing some VPN prefixes, while other site in the same VPN got the complete prefixes
</span>
</li>
<li>
<span>
when the (egress) PE got multicast traffic in a high rate from the (Ingress)
  remote PE that it has no routing info about the source, the PFE <code>HNQ1</code> will be
  slammed and packets started to be dropped
</span>
</li>
<li>
<span>
current implementation use <code>HNQ1</code> to process PIM hello message (and most other
  protocol signalling), therefore hello messages will also be dropped due to the congestion
</span>
<ul class=" incremental">
<li>
<span>
Juniper will continue to work on the fix to move PIM control message(hello) into <code>HNQ0</code>
</span>
</li>
</ul>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_the_end"> the end</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" the end";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p><strong><span class="black red-background big">QUESTIONS???</span></strong></p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph">
<p><strong><span class="black red-background big">THANK YOU!!!</span></strong></p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect1">
<h1 id="appendix">Appendix A: extra stuff</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect1";nexttitle="extra stuff";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_raw_data"> raw data</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" raw data";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>below is the "raw" data that all analysis of this document were based on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>pings@svl-jtac-tool02:~/CSdata/995293/0701$ ls -l
total 293712

//files generated by ping
-rwxr-xr-x  1 pings  others    7434996 Jul  2 18:50 07-01-2014-21903-2.pcapng   #&lt;--the 10.64.0.27+21903 session
-rw-rw-r--  1 pings  others   12380464 Jul  2 23:39 07-01-2014-21903.txt.gz     #&lt;--same, but in pure text
-rwxr-xr-x  1 pings  others     143096 Jul  2 18:53 07-01-2014-21903-win0.pcapng#&lt;-all zero-win-size pkgs in the session
-rwxr-xr-x  1 pings  others      91221 Jul  2 18:53 07-01-2014-21903-win0.txt   #&lt;--same, but in text
-rwxr-xr-x  1 pings  others    9946362 Jul  3 09:01 all-win0.txt                #&lt;--same, but for all bgp sessions
//everything about win0,win0-probe,win0-probe-ack,win-update,etc
-rwxr-xr-x  1 pings  others    7434996 Jul  3 22:59 07-01-2014-21903-all-about-win0.pcapng
//same, but in pure text
-rwxr-xr-x  1 pings  others     183766 Jul  3 22:58 07-01-2014-21903-all-about-win0.txt

//file generated by cisco folk
-rwxr-xr-x  1 pings  others     214732 Jul  2 18:46 Tcpzero.pcapng      #&lt;------cisco folks post processed file

//raw captures/logs
-rwxr-xr-x  1 pings  others  144405372 Jul  2 10:36 07-01-2014.pcap     #&lt;------raw wireshark capture from switch
-rwxr-xr-x  1 pings  others     557056 Jul  1 14:31 bgp-310-27.pcap \
-rwxr-xr-x  1 pings  others          0 Jul  1 13:43 bgp-310-29.pcap  |
-rwxr-xr-x  1 pings  others      57344 Jul  1 14:31 bgp-310-66.pcap  |  #&lt;------juniper shell tcpdump
-rwxr-xr-x  1 pings  others    6868992 Jul  1 14:34 bgp-410-27.pcap  |          capture
-rwxr-xr-x  1 pings  others    3649536 Jul  1 14:33 bgp-410-29.pcap  /
-rwxr-xr-x  1 pings  others     495616 Jul  1 14:31 bgp-410-66.pcap /
-rwxr-xr-x  1 pings  others  135606952 Jul  1 14:33 bgp-trace-ciscoRR   #&lt;------juniper bgp trace log
drwxr-xr-x  2 pings  others       4096 Jul  3 01:43 routerlogs          #&lt;------messages logs in current master RE
drwxr-xr-x  2 pings  others       4096 Jul  3 01:51 routerlogs-backup   #&lt;------same, but from current backup RE</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_a_full_picture_and_root_cause"> A full picture and root cause</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" A full picture and root cause";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>To get a better view of the whole interaction and then pinpoint the issue the
following timeline and main events were listed in the sequence of time, based
on all available data collected during the July 1 replication:</p>
</div>
<ul class="">
<li>
<span>
the pcap capture and
</span>
</li>
<li>
<span>
the Juniper BGP log
</span>
</li>
<li>
<span>
other logs/data
</span>
</li>
</ul>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<ul class="">
<li>
<span>
time in <code>()</code> indicate wireshark time, while others are Juniper router time
  there is an about 3 minutes time difference.
</span>
</li>
<li>
<span>
<code>win0</code> means zero size window tcp packet,<code>win4k</code> means the window size is 4k, so on so forth
</span>
</li>
</ul>
</td>
</tr></table>
</div>
<div class="dlist"><dl class="">
<dt class="hdlist1">
(15:54:34)
</dt>
<dd>
<p>
    1st packet in pcap capture
</p>
<div class="listingblock">
<div class="content">
<pre><tt>1       15:54:34.507018000      10.64.0.27      10.64.96.194    TCP     62      27736 &gt; bgp [SYN] Seq=0 Win=16384 Len=0 MSS=1460 WS=1</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:41:36
</dt>
<dd>
<p>
    RE switchover CLI on Juniper PE
</p>
<div class="listingblock">
<div class="content">
<pre><tt>Jul  1 16:41:36  DESTTG1005ME2-re0 mgd[94562]: UI_CMDLINE_READ_LINE: User 'sarahyu', command 'request chassis routing-engine master switch ' <object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/1.svg" type="image/svg+xml" title="1" width="4%">
<img alt="1" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAABjSURBVHja
VY6xDcAwCAS/pPQaLim9QmajdOk2I2SNrMEIlARIoigU8Cek/4e7zdHaWOYOVwaoA6wOCw05Y7FB
gE0tIWQ+sBcwKM8qoD/wB5wGL8hjfdzWrh01GRp1hInGjDoXwHgsFuzBVLQAAABDdEVYdFNvZnR3
YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8wMSBjcmlzdHlAbXlzdGljLmVzLmR1cG9u
dC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUANThhMDcyZTA3MGRhMjJmNjEzNWNiZDNlNDE0NTQ2
ZjloaiHtAAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30AAAAASUVORK5CYII=" />
</object></tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
16:45:04(16:48:02)
</dt>
<dd>
<p>
    TCP session establish and 1st UPDATE from cisco,after 3m28s of RESO CLI
</p>
<div class="listingblock">
<div class="content">
<pre><tt>#juniper bgp log
Jul 1 16:44:40.877848 bgp_recv: read from peer 10.64.0.27 (Internal AS 61000) failed: Connection reset by peer
Jul 1 16:45:04.418143
Jul 1 16:45:04.418143 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179

#pcap capture
1       16:48:02.727765000      10.64.0.27      10.64.50.94     TCP     62      21903 &gt; bgp [SYN] Seq=0 Win=16384 Len=0 MSS=1460 WS=1
2       16:48:02.759475000      10.64.50.94     10.64.0.27      TCP     62      bgp &gt; 21903 [SYN, ACK] Seq=0 Ack=1 Win=16384 Len=0 MSS=9134 WS=1
...
10      16:48:02.913625000      10.64.0.27      10.64.50.94     BGP     105     UPDATE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:45:24(16:48:22)
</dt>
<dd>
<p>
    first UPDATE from Juniper, 20s after BGP neighborship up.
    this UPDATE contains all RT filter NLRI indicating all Juniper PE wanted VPN routes
</p>
<div class="listingblock">
<div class="content">
<pre><tt>22      16:48:22.196800000      10.64.50.94     10.64.0.27      BGP     1391    UPDATE Message
    ......
    MP Reach NLRI 61000:13979:20011/96 <object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/2.svg" type="image/svg+xml" title="2" width="4%">
<img alt="2" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAAB7SURBVHja
HY6hFcMwDEQ/NDQsNSwU9Apdo7Cw0CsIBoZmhKzQEQJLDQsFVclHpHu693W429Zr7bu541Pg3kCm
Y0K75u9TEUPhuGgWU4mQDvieEaSQEnsT6zKPeZY0EUNtrHMCXvYUuSUg0PsMjUSvpysUT6OOSil9
izp/VNk1YJ8vf6MAAABDdEVYdFNvZnR3YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8w
MSBjcmlzdHlAbXlzdGljLmVzLmR1cG9udC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUAODBlYWU1
MjljOTRhN2Y0N2RlY2NmYWRhMjhhY2I5ZGblb7ENAAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30A
AAAASUVORK5CYII=" />
</object>
    MP Reach NLRI 61000:13979:20012/96
    ......</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
16:45:28(16:48:24)
</dt>
<dd>
<p>
    first <code>win0</code> packet from Juniper (full window usage), 24s after BGP up, indicating routing system is temporarily busy
</p>
<div class="listingblock">
<div class="content">
<pre><tt>83      16:48:24.061194000      10.64.0.27      10.64.50.94     TCP     651     [TCP Window Full] [TCP segment of a reassembled PDU]
84      16:48:24.172268000      10.64.50.94     10.64.0.27      BGP     1151    [TCP ZeroWindow] UPDATE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
(16:48:32)
</dt>
<dd>
<p>
    Juniper ACK.ed CISCO ZWP with 64k window size, indicating more data can be
accepted; CISCO then dumped UPDATE msgs, and Juniper ACK.ed all the data
</p>
<div class="listingblock">
<div class="content">
<pre><tt>574     16:48:32.509961000      10.64.0.27      10.64.50.94     TCP     60      [TCP ZeroWindowProbe] [TCP segment of a reassembled PDU]
    Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: 255654, Ack: 161081, Len: 1
575     16:48:32.516471000      10.64.50.94     10.64.0.27      TCP     60      [TCP ACKed unseen segment] bgp &gt; 21903 [ACK] Seq=161081 Ack=255655 Win=65535 Len=0      <object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/3.svg" type="image/svg+xml" title="3" width="4%">
<img alt="3" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAAB4SURBVHja
JU6rFcNADBM09BqBhl6ltDCwKxQeDOwKB7tGYGCoYaChK6cmlt7TD1W5uap/sgoVBnEXWBTSoOdx
7gpLDOAVorWC0ABdcBPqwZtx8Muf+DPXJpQ96Nu/LSMYl/n17oCOnplTOrpiwW3sUs4ZJmob5/wA
Ubg1Y/zrjUwAAABDdEVYdFNvZnR3YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8wMSBj
cmlzdHlAbXlzdGljLmVzLmR1cG9udC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUAODBiYmRhMjcy
NmRkYWNlOGFiOGEwMWY1OWRlMmViZGII/Q51AAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30AAAAA
SUVORK5CYII=" />
</object>
578     16:48:32.517258000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
    Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: 258575, Ack: 161081, Len: 1460
    5 Reassembled TCP Segments (3965 bytes): #570(623), #574(1), #576(1460), #577(1460), #578(421)
583     16:48:32.616625000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
    Transmission Control Protocol, Src Port: 21903 (21903), Dst Port: bgp (179), Seq: **262955**, Ack: 161081, Len: **1460**
    4 Reassembled TCP Segments (3965 bytes): #578(1039), #580(1460), #581(1460), #583(6)
585     16:48:32.617126000      10.64.50.94     10.64.0.27      TCP     60      bgp &gt; 21903 [ACK] Seq=161081 Ack=**264415** Win=56775 Len=0</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
(16:48:40)
</dt>
<dd>
<p>
    cisco did send some prefixes with the requested RT filter (13979:20011)
</p>
<div class="listingblock">
<div class="content">
<pre><tt>1043    16:48:40.149783000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
1044    16:48:40.149882000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
    2 Reassembled TCP Segments (201 bytes): #1043(22), #1044(179)
    ......
    Network layer reachability information (32 bytes)
        Label Stack=25500 (bottom) RD=13979:90173251, IPv4=11.1.11.0/30
            MP Reach NLRI Prefix length: 118
            MP Reach NLRI Label Stack: 25500 (bottom)
            MP Reach NLRI Route Distinguisher: 13979:90173251
            MP Reach NLRI IPv4 prefix: 11.1.11.0 (11.1.11.0)
        Label Stack=25501 (bottom) RD=13979:90173251, IPv4=14.1.1.2/32
            MP Reach NLRI Prefix length: 120
            MP Reach NLRI Label Stack: 25501 (bottom)
            MP Reach NLRI Route Distinguisher: 13979:90173251
            MP Reach NLRI IPv4 prefix: 14.1.1.2 (14.1.1.2)
    .......
   two-octet AS specific Route Target: 13979:20011
......
1045    16:48:40.150351000      10.64.50.94     10.64.0.27      TCP     60      bgp &gt; 21903 [ACK] Seq=166376 Ack=604395 Win=1038 Len=0</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
(16:52:52.982)
</dt>
<dd>
<p>
cisco sent duplicate UPDATE: frame 6031/6032 vs 1043/1044 (more details later section)??
</p>
<div class="listingblock">
<div class="content">
<pre><tt>6031    16:52:52.982243000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
6032    16:52:52.982330000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message <object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/4.svg" type="image/svg+xml" title="4" width="4%">
<img alt="4" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAABzSURBVHja
HY0hEoUwEEMjkZVYZGVlr1CJxCKRXKPyy28reyVsZeXKsCFi573ZzAQk+x5jaQ6gFQAxIA8XceEN
ZEN3DkOCH/TobUoSVuAYwSSLyzbvaHWVFJxUmmp+PF+twrLkuXzLwPmZ8+OjtH8KS6pGvuoGNo5b
6rzDAAAAQ3RFWHRTb2Z0d2FyZQBAKCMpSW1hZ2VNYWdpY2sgNC4yLjggOTkvMDgvMDEgY3Jpc3R5
QG15c3RpYy5lcy5kdXBvbnQuY29tkbohuAAAACp0RVh0U2lnbmF0dXJlADlmODJmY2FjOWUwMzlj
YmRiNzIzODBhNDU5MTMyNGY1gLv4dgAAAA50RVh0UGFnZQAxMngxMiswKzCEbbt9AAAAAElFTkSu
QmCC" />
</object>
6033    16:52:52.982997000      10.64.50.94     10.64.0.27      TCP     60      bgp &gt; 21903 [ACK] Seq=169178 Ack=3906987 Win=1038 Len=0</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:50:28(16:53:26)
</dt>
<dd>
<p>
    last win0 from juniper, indicating PE got out of the high CPU load situation, after 5min of the 1st <code>win0</code> notification,
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9072    16:53:26.775276000      10.64.50.94     10.64.0.27      TCP     60      [TCP ZeroWindowProbeAck] [TCP ZeroWindow] bgp &gt; 21903 [ACK] Seq=169197 Ack=6262441 Win=0 Len=0</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:50:28(16:53:26)
</dt>
<dd>
<p>
    advertised a win4k and get immediate cisco UPDATE; Juniper ACKed the update
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9073    16:53:26.798710000      10.64.50.94     10.64.0.27      TCP     60      [TCP Window Update] bgp &gt; 21903 [ACK] Seq=169197 Ack=6262441 Win=3965 Len=0
9074    16:53:26.799138000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
9075    16:53:26.799224000      10.64.0.27      10.64.50.94     TCP     1514    [TCP segment of a reassembled PDU]
9076    16:53:26.799688000      10.64.50.94     10.64.0.27      TCP     60      bgp &gt; 21903 [ACK] Seq=169197 Ack=6265361 Win=1045 Len=0</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
16:50:29(16:53:27:628)
</dt>
<dd>
<p>
    last time Juniper tcp <code>full window</code> usage in this session
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9232    16:53:27.628716000      10.64.50.94     10.64.0.27      TCP     60      bgp &gt; 21903 [ACK] Seq=169197 Ack=6394600 Win=446 Len=0
9233    16:53:27.628978000      10.64.0.27      10.64.50.94     BGP     500     [TCP Window Full] UPDATE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:50:29(16:53:27.778)
</dt>
<dd>
<p>
    last piece of first UPDATE from cisco, indicated by a following KA
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9246    16:53:27.778194000      10.64.0.27      10.64.50.94     BGP     156     UPDATE Message
9251    16:54:27.598934000      10.64.0.27      10.64.50.94     BGP     73      KEEPALIVE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
16:51:29(16:54:27)
</dt>
<dd>
<p>
    advertised first win16k after zero size window notification
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9252 16:54:27.698679000  10.64.50.94 -&gt; 10.64.0.27   TCP 60 bgp &gt; 21903 [ACK] Seq=169216 Ack=6403927 Win=16384 Len=0</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
16:51:56(16:54:54)
</dt>
<dd>
<p>
    next UPDATE from cisco
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9255    16:54:54.516243000      10.64.0.27      10.64.50.94     BGP     630     UPDATE Message
9257    16:54:57.704670000      10.64.0.27      10.64.50.94     BGP     123     UPDATE Message
9259    16:54:57.805063000      10.64.0.27      10.64.50.94     BGP     97      UPDATE Message
9263    16:55:57.731894000      10.64.0.27      10.64.50.94     BGP     73      KEEPALIVE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
(17:02:31)
</dt>
<dd>
<p>
    3rd (and more) UPDATE from cisco
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9295    17:02:31.062105000      10.64.0.27      10.64.50.94     BGP     1514    UPDATE Message
......</tt></pre>
</div></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="dlist"><dl class="">
<dt class="hdlist1">
(17:21:46)
</dt>
<dd>
<p>
    last BGP UPDATE from cisco
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9432    17:21:46.825811000      10.64.0.27      10.64.50.94     BGP     262     UPDATE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
(17:22:46)
</dt>
<dd>
<p>
    last BGP (KA) message in this session
</p>
<div class="listingblock">
<div class="content">
<pre><tt>9438    17:22:46.722671000      10.64.0.27      10.64.50.94     BGP     73      KEEPALIVE Message</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
(17:22:46)
</dt>
<dd>
<p>
    the last packet in switch capture
</p>
<div class="listingblock">
<div class="content">
<pre><tt>    439286  17:22:46.887607000      10.64.0.27      10.80.0.63      TCP     60      20304 &gt; bgp [ACK] Seq=1536549 Ack=9231 Win=32084 Len=0</tt></pre>
</div></div>
<div class="colist arabic"><table><tbody>
<tr><td><object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/1.svg" type="image/svg+xml" title="1" width="4%"><img alt="1" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAABjSURBVHja
VY6xDcAwCAS/pPQaLim9QmajdOk2I2SNrMEIlARIoigU8Cek/4e7zdHaWOYOVwaoA6wOCw05Y7FB
gE0tIWQ+sBcwKM8qoD/wB5wGL8hjfdzWrh01GRp1hInGjDoXwHgsFuzBVLQAAABDdEVYdFNvZnR3
YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8wMSBjcmlzdHlAbXlzdGljLmVzLmR1cG9u
dC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUANThhMDcyZTA3MGRhMjJmNjEzNWNiZDNlNDE0NTQ2
ZjloaiHtAAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30AAAAASUVORK5CYII=" /></object></td><td style="vertical-align: middle;">
<code>show log authorization-commands</code>
</td></tr>
<tr><td><object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/2.svg" type="image/svg+xml" title="2" width="4%"><img alt="2" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAAB7SURBVHja
HY6hFcMwDEQ/NDQsNSwU9Apdo7Cw0CsIBoZmhKzQEQJLDQsFVclHpHu693W429Zr7bu541Pg3kCm
Y0K75u9TEUPhuGgWU4mQDvieEaSQEnsT6zKPeZY0EUNtrHMCXvYUuSUg0PsMjUSvpysUT6OOSil9
izp/VNk1YJ8vf6MAAABDdEVYdFNvZnR3YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8w
MSBjcmlzdHlAbXlzdGljLmVzLmR1cG9udC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUAODBlYWU1
MjljOTRhN2Y0N2RlY2NmYWRhMjhhY2I5ZGblb7ENAAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30A
AAAASUVORK5CYII=" /></object></td><td style="vertical-align: middle;">
this is RT filter attaching to just one of the missing route confirmed by AT&amp;T
</td></tr>
<tr><td><object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/3.svg" type="image/svg+xml" title="3" width="4%"><img alt="3" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAAB4SURBVHja
JU6rFcNADBM09BqBhl6ltDCwKxQeDOwKB7tGYGCoYaChK6cmlt7TD1W5uap/sgoVBnEXWBTSoOdx
7gpLDOAVorWC0ABdcBPqwZtx8Muf+DPXJpQ96Nu/LSMYl/n17oCOnplTOrpiwW3sUs4ZJmob5/wA
Ubg1Y/zrjUwAAABDdEVYdFNvZnR3YXJlAEAoIylJbWFnZU1hZ2ljayA0LjIuOCA5OS8wOC8wMSBj
cmlzdHlAbXlzdGljLmVzLmR1cG9udC5jb22RuiG4AAAAKnRFWHRTaWduYXR1cmUAODBiYmRhMjcy
NmRkYWNlOGFiOGEwMWY1OWRlMmViZGII/Q51AAAADnRFWHRQYWdlADEyeDEyKzArMIRtu30AAAAA
SUVORK5CYII=" /></object></td><td style="vertical-align: middle;">
this is a <strong>juniper bug</strong>: send 64k windows update; the <code>[TCP ACKed unseen segment]</code> is a known wireshark bug
</td></tr>
<tr><td><object data="/home/ping/bin/asciidoc-8.6.8/images/icons/callouts/4.svg" type="image/svg+xml" title="4" width="4%"><img alt="4" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAAAmJLR0QAAKqNIzIAAABzSURBVHja
HY0hEoUwEEMjkZVYZGVlr1CJxCKRXKPyy28reyVsZeXKsCFi573ZzAQk+x5jaQ6gFQAxIA8XceEN
ZEN3DkOCH/TobUoSVuAYwSSLyzbvaHWVFJxUmmp+PF+twrLkuXzLwPmZ8+OjtH8KS6pGvuoGNo5b
6rzDAAAAQ3RFWHRTb2Z0d2FyZQBAKCMpSW1hZ2VNYWdpY2sgNC4yLjggOTkvMDgvMDEgY3Jpc3R5
QG15c3RpYy5lcy5kdXBvbnQuY29tkbohuAAAACp0RVh0U2lnbmF0dXJlADlmODJmY2FjOWUwMzlj
YmRiNzIzODBhNDU5MTMyNGY1gLv4dgAAAA50RVh0UGFnZQAxMngxMiswKzCEbbt9AAAAAElFTkSu
QmCC" /></object></td><td style="vertical-align: middle;">
this looks a <strong>cisco bug</strong> for me
</td></tr>
</tbody></table></div>
</dd>
</dl></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect3">
<h1 id="_the_observation"> the observation</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect3";nexttitle=" the observation";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ol class="arabic">
<li>
<span>
When switchover happens, usually RPD is busy in syncing the states,
routes and all. So naturally  RPD can&#8217;t process the socket buffer quickly. BGP
logs shows that for this particular BGP session (10.64.50.94.179 &#8594;
10.64.0.27.21903), no data exchanged for some intervals, minimum 3seconds and
maximum is till 15 seconds.
</span>
<div class="literalblock">
<div class="content">
<pre><tt>Jul  1 16:45:09.377900 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179
Jul  1 16:45:14.870717 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179  ===&gt; 5 seconds gap</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Jul  1 16:45:14.878665 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179
Jul  1 16:45:23.826276 BGP SEND 10.64.50.94+179 -&gt; 10.64.0.27+21903
Jul  1 16:45:29.463285 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179  =====&gt;  15 seconds gap in BGP (RPD) reading the data from the socket buffer</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Jul  1 16:46:13.153217 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179
Jul  1 16:46:18.138359 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Jul  1 16:46:18.189394 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179
Jul  1 16:46:21.672772 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179
Jul  1 16:46:21.687819 BGP RECV 10.64.0.27+21903 -&gt; 10.64.50.94+179</tt></pre>
</div></div>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<ol class="arabic" start="2">
<li>
<span>
When application RPD(BGP) is not reading the data from the socket, TCP
protocol tells the BGP peer to slowdown the data rate(BGP Peer : 10.64.0.27+21903).
This is perfectly acceptable from the TCP side for sending the zero window
as long as application not reading the  data. However tcpdump shows that
maximum contiguous time Juniper PE router advertised zero window is only 3
seconds
</span>
<div class="literalblock">
<div class="content">
<pre><tt>17:48:23.987945 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068137265:3068138425, ack 1176141319, win 794, length 1160: BGP, length: 1160
17:48:24.060983 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068138425:3068139522, ack 1176141516, win 597, length 1097: BGP, length: 1097
17:48:24.172268 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068139522:3068140619, ack 1176142113, win 0, length 1097: BGP, length: 1097
17:48:24.368696 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068140619:3068141716, ack 1176142113, win 0, length 1097: BGP, length: 1097
17:48:27.790712 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068179967:3068180326, ack 1176142113, win 0, length 359: BGP, length: 359
17:48:27.831707 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1176142113, win 4096, length 0
17:48:27.831733 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1176142113, win 7889, length 0
17:48:27.831746 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1176142113, win 11421, length 0  =======&gt; For 3 seconds we have continuously sent zero window, then went till 11k</tt></pre>
</div></div>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<ol class="arabic" start="3">
<li>
<span>
The above zero window ON and OFF behavior went for 5 more minutes (in btw we
have advertised the 4K and other window size to accept data, otherwise session
would have HOLD TIME expired)
</span>
<div class="literalblock">
<div class="content">
<pre><tt>17:53:26.775276 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182383147, win 0, length 0  ======&gt; The last zero window packet sent from Juniper PE side.</tt></pre>
</div></div>
</li>
<li>
<span>
For the next two seconds, the average window size advertised is around 4k
</span>
<div class="literalblock">
<div class="content">
<pre><tt>17:53:27.711194 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182521592, win 2056, length 0
17:53:27.716693 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182523052, win 4554, length 0
17:53:27.777973 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182524512, win 7160, length 0</tt></pre>
</div></div>
</li>
<li>
<span>
Once RPD attained the stable state, it has started consuming the data
quickly, so Juniper PE has started advertising 16K TCP window for BGP peer.
</span>
<div class="literalblock">
<div class="content">
<pre><tt>17:54:27.698679 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182524633, win 16384, length 0
17:54:43.461597 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068287226:3068287245, ack 1182524633, win 16384, length 19: BGP, length: 19</tt></pre>
</div></div>
</li>
<li>
<span>
Juniper PE maintains the window size to 16K for rest of the time
</span>
<div class="literalblock">
<div class="content">
<pre><tt>18:21:55.197819 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068288904:3068288923, ack 1182536949, win 16384, length 19: BGP, length: 19
18:22:45.311679 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [P.], seq 3068288923:3068288942, ack 1182536949, win 16384, length 19: BGP, length: 19
18:22:46.822468 IP 10.64.50.94.179 &gt; 10.64.0.27.21903: Flags [.], ack 1182536968, win 16384, length 0</tt></pre>
</div></div>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_bgp_eor_indicator"> BGP EOR indicator</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" BGP EOR indicator";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>From a BGP perspective we see that Cisco sends an open message and start send updates. One
keepalive is send unnecessary in the stream (2 seconds update gap), but not cause to concern.</p>
</div>
<div class="paragraph">
<p>Then after 5:25 (325 seconds) it appears to send the last initial update. At this point it
is not sending for 60 seconds and then sends a keepalive. There is no way for us to know when
they are done with the initial dump, but it&#8217;s a good assumption that the idle time followed by
a keepalive is that they are done.</p>
</div>
<div class="paragraph">
<p>After this they send a small set of updates. That is <strong>probably</strong> fine. When this is done they
go back to idle and keepalive every 60 seconds.</p>
</div>
<div class="paragraph">
<p>Junos also send the RT target update (request for all routes matching the target) for 13979:20011
at frame 22 (after 19 seconds). That is honored first in frame 168 (6 seconds later) where they
an ipv4 vpn-unicast update with target:13979:20011. This mean they have received the route target
filter and processed it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>4              0.032345000       10.64.0.27            10.64.50.94         BGP       139         OPEN Message
7              0.054382000       10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message
..(updates)
15           5.130752000       10.64.0.27            10.64.50.94         BGP       1001       UPDATE Message
### 2 seconds UPDATE to KEEPALIVE gap
17           7.112151000       10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>### frame 22 has our announcement of the route target 13979:20011:
22           19.469035000     10.64.50.94         10.64.0.27            BGP       1391       UPDATE Message</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>### 07-01-2014-21903-wshark.txt.gz:4128:     22 16:48:22.196800000 10.64.50.94           10.64.0.27            BGP      1391   UPDATE Message
### 07-01-2014-21903-wshark.txt.gz:4206:Border Gateway Protocol - UPDATE Message
### 07-01-2014-21903-wshark.txt.gz:4209:    Type: UPDATE Message (2)
### 07-01-2014-21903-wshark.txt.gz:4322:                MP Reach NLRI 61000:13979:20011/96
### 07-01-2014-21903-wshark.txt.gz:4325:                    MP Reach NLRI Community prefix: 13979:20011</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>### frame 168 has the route target 13979:20011 for ipv4 vpn-unicast routes:
168         25.141164000     10.64.50.94         10.64.0.27            BGP       1514       UPDATE Message
..</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>..(updates)
9246       325.050429000   10.64.0.27            10.64.50.94         BGP       156         UPDATE Message
### 60 seconds UPDATE to KEEPALIVE gap
9251       384.871169000   10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message
9255       411.788478000   10.64.0.27            10.64.50.94         BGP       630         UPDATE Message
9257       414.976905000   10.64.0.27            10.64.50.94         BGP       123         UPDATE Message
9259       415.077298000   10.64.0.27            10.64.50.94         BGP       97           UPDATE Message
### 60 seconds UPDATE to KEEPALIVE gap
9263       475.004129000   10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message
### 60 seconds inter KEEPALIVE gap
9267       535.002973000   10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message
### 60 seconds inter KEEPALIVE gap
9271       595.001288000   10.64.0.27            10.64.50.94         BGP       73           KEEPALIVE Message</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_data_collection_in_juniper_pe"> data collection in Juniper PE</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" data collection in Juniper PE";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect3">
<h1 id="_tcpdump"> tcpdump</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect3";nexttitle=" tcpdump";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>because no NSR was enabled, the BGP session will be bounced after each GRES
switchover.  to make sure the whole new BGP session can be captured, the
following tcpdump commands were executed from the <strong>backup</strong> RE, <strong>before</strong> the
RE switchover:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>tcpdump -ni ge-3/1/0 -w bgp-310-27.pcap -s 2000 host 10.64.0.27 and port 179 &amp;
tcpdump -ni ge-4/1/0 -w bgp-410-27.pcap -s 2000 host 10.64.0.27 and port 179 &amp;
tcpdump -ni ge-3/1/0 -w bgp-310-29.pcap -s 2000 host 10.64.0.29 and port 179 &amp;
tcpdump -ni ge-4/1/0 -w bgp-410-29.pcap -s 2000 host 10.64.0.29 and port 179 &amp;
tcpdump -ni ge-3/1/0 -w bgp-310-66.pcap -s 2000 host 10.64.0.66 and port 179 &amp;
tcpdump -ni ge-4/1/0 -w bgp-410-66.pcap -s 2000 host 10.64.0.66 and port 179 &amp;</tt></pre>
</div></div>
<div class="paragraph">
<p>t.b.c</p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect3">
<h1 id="_bgp_traceoptions"> BGP traceoptions</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect3";nexttitle=" BGP traceoptions";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>t.b.c</p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_steps_to_search_the_bgp_logs_for_any_specific_routes"> steps to search the BGP logs for any specific routes</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" steps to search the BGP logs for any specific routes";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>searching in the bgp trace logs confirmed the missing prefix had never been received.</p>
</div>
<div class="sidebarblock">
<div class="content">
<ul class="">
<li>
<span>
BGP tracelogs, same as other Juniper router logs, once enabled, will generate
  huge log files when the routing table was big (100+M routes) and the session
  was toggled.
</span>
</li>
<li>
<span>
Copying the files to external server just for searching is time consuming work.
</span>
</li>
<li>
<span>
Junos CLI <code>match</code>:there is no good way to <strong>only</strong> display the prefixes being
  searched along with the source (neighbor from which the prefixes were
  advertised).
</span>
</li>
<li>
<span>
a much quicker method is to search the logs from Juniper unix shell <code>grep</code> command,
  on the fly, as shown next.
</span>
</li>
</ul>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="title">a verification flow could be like this:</div><ol class="arabic" start="1">
<li>
<span>
get the tcp tuple and RE switch time:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>{master}
j-tac-ps1@DESTTG1005ME2-re1&gt; show bgp neighbor 10.64.0.27 | match "\+"
Jul 01 18:55:22
Peer: 10.64.0.27+21903 AS 61000 Local: 10.64.50.94+179 AS 61000</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>{master}
j-tac-ps1@DESTTG1005ME2-re1&gt; show bgp neighbor 10.64.0.29 | match "\+"
Jul 01 18:55:30
Peer: 10.64.0.29+27276 AS 61000 Local: 10.64.50.94+179 AS 61000</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>j-tac-ps1@DESTTG1005ME2-re0&gt; ...commands | match "request chassis rout"
Jul  1 16:41:36  DESTTG1005ME2-re0 mgd[94562]: UI_CMDLINE_READ_LINE: User 'sarahyu', command 'request chassis routing-engine master switch '</tt></pre>
</div></div>
</li>
</ol>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<ol class="arabic" start="2">
<li>
<span>
collect reported missing prefix:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>55.21.1.0/24       *[BGP/170] 00:42:59, localpref 100, from 10.64.0.29
33.111.1.0/24      *[BGP/170] 00:46:06, localpref 100, from 10.64.0.29
33.119.31.0/24     *[BGP/170] 00:20:29, localpref 100, from 10.64.0.29
10.64.0.13/32      *[BGP/170] 00:22:45, MED 0, localpref 100, from 10.64.0.29
99.1.1.0/30        *[BGP/170] 00:23:49, localpref 100, from 10.64.0.29</tt></pre>
</div></div>
</li>
<li>
<span>
grep the routes in shell level of the router to verify the BGP source of these prefixes:
</span>
<div class="literalblock">
<div class="content">
<pre><tt>grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:55\.21\.1\.0" /var/log/bgp-trace-ciscoRR   | grep -B1 ":55\.21\.1\.0"
grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:33\.111\.1\.0" /var/log/bgp-trace-ciscoRR  | grep -B1 ":33\.111\.1\.0"
grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:33\.119\.31\.0" /var/log/bgp-trace-ciscoRR | grep -B1 ":33\.119\.31\.0"
grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:10\.64\.0\.13" /var/log/bgp-trace-ciscoRR  | grep -B1 "15437:10\.64\.0\.13"
grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:99\.1\.1\.0" /var/log/bgp-trace-ciscoRR    | grep -B1 ":99\.1\.1\.0"</tt></pre>
</div></div>
</li>
</ol>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
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" />
</td>
<td class="content">
<div class="dlist"><dl class="">
<dt class="hdlist1">
<code>-inE</code>
</dt>
<dd>
<p>
a case-insensitive search, with regular expression support and line number support
</p>
</dd>
<dt class="hdlist1">
<code>-B1</code>
</dt>
<dd>
<p>
display the matching string (the prefix) AND just one more line(the source) before it
</p>
</dd>
</dl></div>
</td>
</tr></table>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="literalblock">
<div class="title">the result:</div>
<div class="content">
<pre><tt>%     grep -inE "10\.64\.0\.29\+27276 -> |10\.64\.0\.27\+21903 -> |:55\.21\.1\.0" /var/log/bgp-trace-ciscoRR   | grep -B1 ":55\.21\.1\.0"
375028:Jul  1 16:47:07.940985 BGP RECV <strong>10.64.0.29</strong>+27276 -> 10.64.50.94+179
375057:Jul  1 16:47:07.941509 BGP RECV  13979:90173251:55.21.4.0/24 (label 25505) , 13979:90173251:55.21.3.0/24 (label 25504) , 13979:90173251:55.21.2.0/24 (label 25503) , 13979:90173251:55.21.1.0/24 (label 25502)
375165:Jul  1 16:47:07.957437 bgp_rcv_nlri: 13979:90173251:55.21.1.0/88
--
1223040:Jul  1 16:50:05.673077 BGP RECV <strong>10.64.0.29</strong>+27276 -> 10.64.50.94+179
1223069:Jul  1 16:50:05.673510 BGP RECV         13979:90173251:55.21.4.0/24 (label 25505) , 13979:90173251:55.21.3.0/24 (label 25504) , 13979:90173251:55.21.2.0/24 (label 25503) , 13979:90173251:55.21.1.0/24 (label 25502)
1223276:Jul  1 16:50:05.675682 bgp_rcv_nlri: 13979:90173251:55.21.1.0/88
1223277:Jul  1 16:50:05.675693 bgp_rcv_nlri: 13979:90173251:55.21.1.0/88 duplicate update</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>%     grep -inE "10\.64\.0\.29\+27276 -&gt; |10\.64\.0\.27\+21903 -&gt; |:10\.64\.0\.13" /var/log/bgp-trace-ciscoRR  | grep -B1 "15437:10\.64\.0\.13"
122000:Jul  1 16:45:42.891632 BGP RECV **10.64.0.29**+27276 -&gt; 10.64.50.94+179
122005:Jul  1 16:45:42.891674 BGP RECV  268454126L:15437:10.64.0.13/32 (label 3)
122013:Jul  1 16:45:42.891916 bgp_rcv_nlri: 268454126L:15437:10.64.0.13/96
--
783989:Jul  1 16:49:56.079926 BGP RECV **10.64.0.29**+27276 -&gt; 10.64.50.94+179
783994:Jul  1 16:49:56.079972 BGP RECV  268454126L:15437:10.64.0.13/32 (label 3)
784002:Jul  1 16:49:56.080102 bgp_rcv_nlri: 268454126L:15437:10.64.0.13/96
784003:Jul  1 16:49:56.080120 bgp_rcv_nlri: 268454126L:15437:10.64.0.13/96 duplicate update</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph"><div class="title">conclusion:</div>
<p>none of the missing routes are received from cisco RR .27</p>
</div>
<div class="paragraph">
<p>if some of the prefix does show sourcing from .27, then check the RD and we are
sure they are not the same missing routes that we are looking at:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>j-tac-ps1@DESTTG1005ME2-re1&gt; show route table 61000:313.inet.0 10.64.0.13/32 extensive | match dist
Jul 01 19:10:14
                Route Distinguisher: 268454126L:15437
                Route Distinguisher: 268454126L:15437
                Route Distinguisher: 268454126L:15437
                Route Distinguisher: 268454126L:15437</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_pcap_pcapng_tcpdump_and_wireshark_issues"> pcap,pcapng,tcpdump and wireshark issues</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" pcap,pcapng,tcpdump and wireshark issues";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>t.b.c summary of known issues of the tools</p>
</div>
<div class="paragraph"><div class="title">other things:</div>
<p><a href="http://www.wireshark.org/lists/wireshark-bugs/201302/msg00945.html">wireshark Bug 8404</a></p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="tshark"> tshark: terminal version of wireshark (powerful!!)</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" tshark: terminal version of wireshark (powerful!!)";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
tcpdump is classic/legentary tool, but no much support for high level
  protocol content searching
</span>
</li>
<li>
<span>
wireshark is great and easier to search, but requires X or a more powerful PC
</span>
</li>
<li>
<span>
tshark is a good combination:
</span>
<ul class="">
<li>
<span>
as powerful as wireshark, especially in that "display filter expression".
</span>
</li>
<li>
<span>
terminal based, less memory usage, good for CLI pipe streams
</span>
</li>
</ul>
</li>
</ul>
<div class="paragraph">
<p>some tshark quick examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>tshark -r 07-01-2014-21903-2.pcapng -R "tcp.window_size == 16384" -t a | vim -
tshark -r 07-01-2014-21903-2.pcapng -R "tcp.window_size == 0" -t a | vim -
tshark -r 07-01-2014.pcap -R "tcp.window_size == 0" | grep -iEv "10\.64\.0\.27" | less
tshark -r 06-30-2014 -R "ip.src==10.64.0.27 and tcp.srcport==33659"
tshark -r 07-01-2014-21903-2.pcapng -V &gt; test.txt
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix==55.21.1.0" -t a
tshark -r 07-01-2014.pcap -R "bgp.mp_reach_nlri_ipv4_prefix==55.21.1.0" -t a
zgrep -niHE "open|route target filter" 07-01-2014-21903-wshark.txt.gz</tt></pre>
</div></div>
<div class="paragraph">
<p>some display filters I used in this case:</p>
</div>
<div class="literalblock">
<div class="content">
<pre><tt>tcp.analysis.zero_window                (or tcp.window_size == 0)
tcp.analysis.window_update
tcp.analysis.zero_window_probe
tcp.analysis.zero_window_probe_ack</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>tcp.analysis.zero_window or tcp.analysis.window_update or tcp.analysis.zero_window_probe or tcp.analysis.zero_window_probe_ack</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>bgp.type==2         update msg only</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>bgp.type==2 and ip.src==10.64.0.27 all update from an IP</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>(frame.number&gt;=21) and (frame.number&lt;=9248) and bgp.type==2 and ip.src==10.64.0.27</tt></pre>
</div></div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect3">
<h1 id="_example_search_a_vpn_prefix_es_in_pcap_pcapng_file"> example: search (a) VPN prefix(es) in pcap/pcapng file</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect3";nexttitle=" example: search (a) VPN prefix(es) in pcap/pcapng file";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<div class="paragraph">
<p>in this case customer provided the following prefixes that was observed to be
"missing" from Juniper PE, we need to know whether these prefixes ever appeared
in the captured data (&gt;500M pcapng file, sometime even much bigger) or not:</p>
</div>
<ul class="">
<li>
<span>
<code>55.21.1~10.0</code>
</span>
</li>
<li>
<span>
<code>33.111.1~10.0</code>
</span>
</li>
<li>
<span>
<code>33.119.31~40.0</code>
</span>
</li>
<li>
<span>
<code>10.64.0.13</code>
</span>
</li>
<li>
<span>
<code>99.1.1~10.0</code>
</span>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">
<div class="sect1">
<script type="text/javascript">/*<![CDATA[*/subslide +=1;document.write("<h1 class='"+nextclass+"'>"+nexttitle+" ("+ subslide+")</h1>");slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">

<div class="paragraph">
<p>based on that following tshark commands can be composed for that purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix==55.21.1.0" -t a
...
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix==55.21.10.0" -t a
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="33.111.1.0" -t a
...
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="33.111.10.0" -t a
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="33.119.31.0" -t a
...
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="33.119.40.0" -t a
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="10.64.0.13" -t a
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="99.1.1.0" -t a
...
tshark -r 07-01-2014-21903-2.pcapng -R "bgp.mp_reach_nlri_ipv4_prefix=="99.1.10.0" -t a</tt></pre>
</div></div>
<div class="paragraph">
<p>the commands printed the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>193985 16:24:12.914088000   10.64.0.27 -&gt; 10.64.50.94  BGP 1514 UPDATE Message
193968 16:24:12.515651000   10.64.0.27 -&gt; 10.64.50.94  BGP 1514 UPDATE Message
193479 16:24:08.429774000   10.64.0.27 -&gt; 10.64.50.94  BGP 1514 UPDATE Message
192531 16:23:58.318681000   10.64.0.27 -&gt; 10.64.50.94  BGP 1514 UPDATE Message</tt></pre>
</div></div>
<div class="paragraph">
<p>From millions of packets, 4 packets were found to (possibly) contains the BGP VPNv4 prefix
that we were looking for, making manual checking much easier&#8230;</p>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_references"> references</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" references";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
DEs (and others) from different groups helped to investigate the issue and
  provide the support of "how-toin different stages of the issue, especially:
</span>
<ul class="">
<li>
<span>
<a href="mailto:rkebler@juniper.net">Robert Kebler</a>
</span>
</li>
<li>
<span>
<a href="mailto:kurtw@juniper.net">Kurt Windisch</a>
</span>
</li>
<li>
<span>
<a href="mailto:jarora@juniper.net">Jitender Kumar Arora</a>
</span>
</li>
<li>
<span>
<a href="mailto:kaliraj@juniper.net">Kaliraj Vairavakkalai</a>
</span>
</li>
<li>
<span>
<a href="mailto:mdjernaes@juniper.net">Martin Djernaes</a>
</span>
</li>
<li>
<span>
<a href="mailto:srushtigs@juniper.net">Srushti Gowdru Shivakumara</a>
</span>
</li>
</ul>
</li>
<li>
<span>
<a href="https://gnats.juniper.net/web/default/995293">PR995293</a>
</span>
</li>
</ul>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div><div class="slide asciidocslidy">

<div class="sect2">
<h1 id="_other_version_of_this_doc"> other version of this doc</h1>
<script type="text/javascript">/*<![CDATA[*/subslide=1;nextclass="sect2";nexttitle=" other version of this doc";slidefootnotes="";/*]]>*/</script>
<div class="sectionbody">
<ul class="">
<li>
<span>
<a href="http://www-in.juniper.net/~pings/myblog/docs/multicast/995293-missing-route(slidy2).html">html slide (slidy2 format,this doc)</a>
</span>
</li>
<li>
<span>
<a href="http://www-in.juniper.net/~pings/myblog/docs/multicast/995293-missing-route.pdf">latex pdf</a>
</span>
</li>
<li>
<span>
<a href="http://www-in.juniper.net/~pings/myblog/docs/multicast/995293-missing-route.html">html with a TOC</a>
</span>
</li>
<li>
<span>
<a href="http://www-in.juniper.net/~pings/myblog/docs/multicast/995293-missing-route-toc2.html">html with a side TOC</a>
</span>
</li>
<li>
<span>
<a href="http://www-in.juniper.net/~pings/myblog/docs/multicast/995293-missing-route.txt">asciidoc source of this doc</a>
</span>
</li>
</ul>
<div id="footer" style="position: absolute; left: 5%; top: 80%; width: 90%;">
<div id="footer-text">
Last updated 2014-08-15 11:54:42 EDT
</div>
</div>
</div></div>
<script type="text/javascript">/*<![CDATA[*/if (slidefootnotes != ''){document.write("<hr/><p>"+slidefootnotes+"</p>");}/*]]>*/</script>
</div>
<script type="text/javascript">
/*<![CDATA[*/
    // move the div class="background" elements immediately
    // as document.body children
    var re = new RegExp("(^| )background\W*");
    var divs = document.body.getElementsByTagName("div");
    for (var i = (divs.length - 1); i >= 0 ; --i)
    {
      div = divs.item(i);
      if ( re.test(div.getAttribute("class")) )
      {
        div2 = div.cloneNode(true);
        div.parentNode.removeChild(div);
        document.body.appendChild(div2);
      }
    }
/*]]>*/
</script>
</body>
</html>
